@model WebApp.Models.Permission.UserProfileViewModel
@{
    ViewData["Title"] = "Quản lý Profile";
}

<style>
    .profile-header {
        background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(139,92,246,0.1) 100%);
        border-left: 4px solid #3b82f6;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .profile-header h2 {
        margin: 0;
        color: #1e40af;
        font-weight: 600;
    }

    .profile-card {
        background: linear-gradient(135deg, 
            rgba(240, 253, 255, 0.2) 0%, 
            rgba(224, 242, 254, 0.18) 25%,
            rgba(186, 230, 253, 0.2) 50%,
            rgba(224, 242, 254, 0.18) 75%,
            rgba(240, 253, 255, 0.2) 100%);
        border-radius: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(125, 211, 252, 0.3);
        margin-bottom: 1.5rem;
        overflow: hidden;
    }

    .profile-card-header {
        background: linear-gradient(135deg, 
            rgba(59, 130, 246, 0.8) 0%,
            rgba(37, 99, 235, 0.85) 25%,
            rgba(139, 92, 246, 0.9) 50%,
            rgba(168, 85, 247, 0.85) 75%,
            rgba(192, 132, 252, 0.8) 100%);
        color: white;
        padding: 1rem 1.5rem;
        font-weight: 600;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .profile-card-body {
        padding: 1.5rem;
    }

    .profile-table-container {
        max-height: 400px;
        overflow-y: auto;
        border-radius: 0.5rem;
        background: rgba(255, 255, 255, 0.3);
    }

    .profile-table-container::-webkit-scrollbar {
        width: 8px;
    }

    .profile-table-container::-webkit-scrollbar-track {
        background: rgba(226, 232, 240, 0.3);
        border-radius: 4px;
    }

    .profile-table-container::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.6) 0%, rgba(168, 85, 247, 0.6) 100%);
        border-radius: 4px;
    }

    .profile-table {
        width: 100%;
        margin: 0;
        border-collapse: collapse;
    }

    .profile-table thead {
        position: sticky;
        top: 0;
        z-index: 10;
        background: linear-gradient(135deg, 
            rgba(59, 130, 246, 0.9) 0%,
            rgba(139, 92, 246, 0.95) 50%,
            rgba(168, 85, 247, 0.9) 100%);
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .profile-table thead th {
        padding: 0.875rem;
        font-weight: 600;
        text-align: center;
        font-size: 0.8125rem;
        letter-spacing: 0.025em;
        border: none;
        white-space: nowrap;
    }

    .profile-table tbody tr {
        border-bottom: 1px solid rgba(186, 230, 253, 0.25);
        transition: background 0.3s ease;
        background: rgba(255, 255, 255, 0.5);
    }

    .profile-table tbody tr:hover {
        background: linear-gradient(90deg, 
            rgba(147, 197, 253, 0.25) 0%,
            rgba(96, 165, 250, 0.22) 50%,
            rgba(147, 197, 253, 0.25) 100%);
    }

    .profile-table tbody td {
        padding: 0.75rem;
        color: #475569;
        font-size: 0.8125rem;
        vertical-align: middle;
        text-align: center;
        border: none;
    }

    .form-control, .form-select {
        border: 1px solid rgba(96, 165, 250, 0.3);
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        font-size: 0.875rem;
    }

    .form-control:focus, .form-select:focus {
        border-color: rgba(59, 130, 246, 0.5);
        box-shadow: 0 0 0 0.2rem rgba(96, 165, 250, 0.25);
    }

    .form-label {
        font-weight: 600;
        color: #475569;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .btn-gradient {
        background: linear-gradient(135deg, 
            rgba(251, 146, 60, 0.8) 0%,
            rgba(249, 115, 22, 0.85) 25%,
            rgba(234, 88, 12, 0.9) 50%,
            rgba(239, 68, 68, 0.85) 75%,
            rgba(220, 38, 38, 0.8) 100%);
        border: none;
        color: white;
        padding: 0.625rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 4px 6px rgba(249, 115, 22, 0.3);
    }

    .btn-gradient:hover {
        background: linear-gradient(135deg, 
            rgba(249, 115, 22, 0.95) 0%,
            rgba(234, 88, 12, 1) 25%,
            rgba(220, 38, 38, 0.95) 50%,
            rgba(185, 28, 28, 1) 75%,
            rgba(153, 27, 27, 0.95) 100%);
        box-shadow: 0 6px 12px rgba(249, 115, 22, 0.4);
        color: white;
    }

    .btn-danger-gradient {
        background: linear-gradient(135deg, 
            rgba(251, 113, 133, 0.7) 0%,
            rgba(239, 68, 68, 0.75) 50%, 
            rgba(220, 38, 38, 0.7) 100%);
        border: none;
        color: white;
        padding: 0.625rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
    }

    .btn-danger-gradient:hover {
        background: linear-gradient(135deg, 
            rgba(239, 68, 68, 0.9) 0%,
            rgba(220, 38, 38, 0.95) 50%, 
            rgba(185, 28, 28, 0.9) 100%);
        box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);
        color: white;
    }

    .btn-warning-gradient {
        background: linear-gradient(135deg, 
            rgba(251, 191, 36, 0.7) 0%,
            rgba(245, 158, 11, 0.75) 50%,
            rgba(217, 119, 6, 0.7) 100%);
        border: none;
        color: white;
        padding: 0.625rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
    }

    .btn-warning-gradient:hover {
        background: linear-gradient(135deg, 
            rgba(245, 158, 11, 0.9) 0%,
            rgba(217, 119, 6, 0.95) 50%,
            rgba(180, 83, 9, 0.9) 100%);
        box-shadow: 0 6px 12px rgba(245, 158, 11, 0.4);
        color: white;
    }

    .btn-success-gradient {
        background: linear-gradient(135deg, 
            rgba(34, 211, 238, 0.8) 0%,
            rgba(6, 182, 212, 0.85) 25%,
            rgba(8, 145, 178, 0.9) 50%,
            rgba(14, 116, 144, 0.85) 75%,
            rgba(21, 94, 117, 0.8) 100%);
        border: none;
        color: white;
        padding: 0.625rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        box-shadow: 0 4px 6px rgba(6, 182, 212, 0.3);
    }

    .btn-success-gradient:hover {
        background: linear-gradient(135deg, 
            rgba(6, 182, 212, 0.95) 0%,
            rgba(8, 145, 178, 1) 25%,
            rgba(14, 116, 144, 0.95) 50%,
            rgba(21, 94, 117, 1) 75%,
            rgba(15, 76, 92, 0.95) 100%);
        box-shadow: 0 6px 12px rgba(6, 182, 212, 0.4);
        color: white;
    }
</style>

<div class="profile-header">
    <h2>Quản lý Profile</h2>
</div>

@if (TempData["CreateProfileMessage"] != null)
{
    <div class="alert alert-info">@TempData["CreateProfileMessage"]</div>
}
@if (TempData["DeleteProfileMessage"] != null)
{
    <div class="alert alert-warning">@TempData["DeleteProfileMessage"]</div>
}
@if (TempData["UpdateProfileMessage"] != null)
{
    <div class="alert alert-info">@TempData["UpdateProfileMessage"]</div>
}
@if (TempData["AssignProfileMessage"] != null)
{
    <div class="alert alert-success">@TempData["AssignProfileMessage"]</div>
}
@if (TempData["RevokeProfileMessage"] != null)
{
    <div class="alert alert-danger">@TempData["RevokeProfileMessage"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-card-list"></i> Danh sách Profile
            </div>
            <div class="profile-card-body">
                <div class="mb-3">
                    <input type="text" id="search-profile" class="form-control" placeholder="Tìm kiếm profile..." />
                </div>
                <div class="profile-table-container">
                    <table class="profile-table">
                        <thead>
                            <tr>
                                <th>Profile Name</th>
                                <th>Idle Time</th>
                                <th>Connect Time</th>
                                <th>Failed Login</th>
                                <th>Lock Time</th>
                                <th>Inactive Account Time</th>
                            </tr>
                        </thead>
                        <tbody id="profile-list">
                            @if (Model.Profiles.Any())
                            {
                                foreach (var profile in Model.Profiles)
                                {
                                    <tr class="profile-row" data-profile="@profile.ProfileName.ToLower()">
                                        <td class="fw-semibold">@profile.ProfileName</td>
                                        <td>@profile.IdleTime</td>
                                        <td>@profile.ConnectTime</td>
                                        <td>@profile.FailedLogin</td>
                                        <td>@profile.LockTime</td>
                                        <td>@profile.InactiveAccountTime</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-muted">Không có profile nào.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div id="no-profile-result" class="text-muted text-center py-3" style="display: none;">
                        <i class="bi bi-search"></i> Không tìm thấy profile
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-people"></i> User và Profile
            </div>
            <div class="profile-card-body">
                <div class="mb-3">
                    <input type="text" id="search-user" class="form-control" placeholder="Tìm kiếm user..." />
                </div>
                <div class="profile-table-container">
                    <table class="profile-table">
                        <tbody id="user-list">
                            @if (Model.Users != null && Model.Users.Any())
                            {
                                foreach (var user in Model.Users)
                                {
                                    <tr class="user-row" data-username="@user.Username.ToLower()">
                                        <td class="fw-semibold">@user.Username</td>
                                        <td>@user.Profile</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="2" class="text-muted">Không có user nào.</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div id="no-user-result" class="text-muted text-center py-3" style="display: none;">
                        <i class="bi bi-search"></i> Không tìm thấy user
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-plus-circle"></i> Tạo Profile mới
            </div>
            <div class="profile-card-body">
                <form asp-action="CreateProfile" method="post">
                    <div class="mb-3">
                        <label for="ProfileName" class="form-label">Tên Profile</label>
                        <input type="text" name="ProfileName" class="form-control" placeholder="Nhập tên profile" required />
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="IdleTime" class="form-label">Idle Time</label>
                            <input type="text" name="IdleTime" class="form-control" value="UNLIMITED" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="ConnectTime" class="form-label">Connect Time</label>
                            <input type="text" name="ConnectTime" class="form-control" value="UNLIMITED" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="FailedLogin" class="form-label">Failed Login</label>
                            <input type="text" name="FailedLogin" class="form-control" value="UNLIMITED" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="LockTime" class="form-label">Lock Time</label>
                            <input type="text" name="LockTime" class="form-control" value="UNLIMITED" />
                        </div>
                        <div class="col-12 mb-2">
                            <label for="InactiveAccountTime" class="form-label">Inactive Account Time</label>
                            <input type="text" name="InactiveAccountTime" class="form-control" value="UNLIMITED" />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-gradient w-100 mt-2">
                        <i class="bi bi-plus-circle"></i> Tạo Profile
                    </button>
                </form>
            </div>
        </div>

        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-trash"></i> Xóa Profile
            </div>
            <div class="profile-card-body">
                <form asp-action="DeleteProfile" method="post">
                    <div class="mb-3">
                        <label for="profileName" class="form-label">Chọn Profile</label>
                        <select name="profileName" class="form-select" required>
                            <option value="">-- Chọn Profile --</option>
                            @foreach (var p in Model.Profiles)
                            {
                                <option value="@p.ProfileName">@p.ProfileName</option>
                            }
                        </select>
                    </div>
                    <button type="submit" class="btn btn-danger-gradient w-100">
                        <i class="bi bi-trash"></i> Xóa Profile
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-6 mb-4">
        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-pencil-square"></i> Cập nhật Profile
            </div>
            <div class="profile-card-body">
                <form asp-action="UpdateProfile" method="post">
                    <div class="mb-3">
                        <label for="ProfileName" class="form-label">Chọn Profile</label>
                        <select name="ProfileName" id="updateProfileName" class="form-select" required>
                            <option value="">-- Chọn Profile --</option>
                            @foreach (var p in Model.Profiles)
                            {
                                <option value="@p.ProfileName">@p.ProfileName</option>
                            }
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="IdleTime" class="form-label">Idle Time</label>
                            <input type="text" name="IdleTime" class="form-control" placeholder="UNLIMITED hoặc số" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="ConnectTime" class="form-label">Connect Time</label>
                            <input type="text" name="ConnectTime" class="form-control" placeholder="UNLIMITED hoặc số" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="FailedLogin" class="form-label">Failed Login</label>
                            <input type="text" name="FailedLogin" class="form-control" placeholder="UNLIMITED hoặc số" />
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="LockTime" class="form-label">Lock Time</label>
                            <input type="text" name="LockTime" class="form-control" placeholder="UNLIMITED hoặc số" />
                        </div>
                        <div class="col-12 mb-2">
                            <label for="InactiveAccountTime" class="form-label">Inactive Time</label>
                            <input type="text" name="InactiveAccountTime" class="form-control" placeholder="UNLIMITED hoặc số" />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-warning-gradient w-100 mt-2">
                        <i class="bi bi-pencil-square"></i> Cập nhật Profile
                    </button>
                </form>
            </div>
        </div>

        <div class="profile-card">
            <div class="profile-card-header">
                <i class="bi bi-person-check"></i> Gán Profile cho User
            </div>
            <div class="profile-card-body">
                <form asp-action="AssignProfile" method="post">
                    <div class="mb-3">
                        <label for="userName" class="form-label">Chọn User</label>
                        <select name="userName" class="form-select" required>
                            <option value="">-- Chọn User --</option>
                            @foreach (var u in Model.Users)
                            {
                                <option value="@u.Username">@u.Username</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="profileName" class="form-label">Chọn Profile</label>
                        <select name="profileName" class="form-select" required>
                            <option value="">-- Chọn Profile --</option>
                            @foreach (var p in Model.Profiles)
                            {
                                <option value="@p.ProfileName">@p.ProfileName</option>
                            }
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success-gradient w-100">
                        <i class="bi bi-person-check"></i> Gán Profile
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Tìm kiếm Profile
        const searchProfileInput = document.getElementById('search-profile');
        const profileList = document.getElementById('profile-list');
        const noProfileResult = document.getElementById('no-profile-result');

        searchProfileInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const profileRows = profileList.querySelectorAll('.profile-row');
            let visibleCount = 0;

            profileRows.forEach(row => {
                const profileName = row.dataset.profile;
                if (profileName.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Hiển thị thông báo nếu không tìm thấy
            if (visibleCount === 0 && profileRows.length > 0) {
                noProfileResult.style.display = 'block';
            } else {
                noProfileResult.style.display = 'none';
            }
        });

        // Tìm kiếm User
        const searchUserInput = document.getElementById('search-user');
        const userList = document.getElementById('user-list');
        const noUserResult = document.getElementById('no-user-result');

        searchUserInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            const userRows = userList.querySelectorAll('.user-row');
            let visibleCount = 0;

            userRows.forEach(row => {
                const username = row.dataset.username;
                if (username.includes(searchTerm)) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Hiển thị thông báo nếu không tìm thấy
            if (visibleCount === 0 && userRows.length > 0) {
                noUserResult.style.display = 'block';
            } else {
                noUserResult.style.display = 'none';
            }
        });
    </script>
}
