@{
    ViewData["Title"] = "Backup & Restore";
}

<div class="container-fluid">
    <h2 class="mb-4">@ViewData["Title"]</h2>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Th√†nh c√¥ng!</strong> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>L·ªói!</strong> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        üì¶ RMAN Backup
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Ch·∫°y job backup RMAN ƒë·ªÉ sao l∆∞u PDB. Job s·∫Ω ƒë∆∞·ª£c th·ª±c thi ngay l·∫≠p t·ª©c.
                    </p>
                    <p class="text-muted small">
                        <strong>Job:</strong> RUN_RMAN_PDB_BACKUP
                    </p>
                    <form asp-action="Backup" method="post" id="backupForm">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-primary btn-lg w-100" id="btnBackup">
                            ‚¨áÔ∏è Ch·∫°y Backup
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        üîÑ RMAN Restore
                    </h5>
                </div>
                <div class="card-body">
                    <p class="card-text">
                        Ch·∫°y job restore RMAN ƒë·ªÉ kh√¥i ph·ª•c PDB t·ª´ backup. <strong class="text-danger">C·∫£nh b√°o:</strong> Thao t√°c n√†y c√≥ th·ªÉ ghi ƒë√® d·ªØ li·ªáu hi·ªán t·∫°i.
                    </p>
                    <p class="text-muted small">
                        <strong>Job:</strong> RUN_RMAN_PDB_RESTORE
                    </p>
                    <form asp-action="Restore" method="post" id="restoreForm">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-warning btn-lg w-100" id="btnRestore" onclick="return confirmRestore()">
                            ‚¨ÜÔ∏è Ch·∫°y Restore
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        ‚ÑπÔ∏è Th√¥ng tin
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li><strong>Quy·ªÅn truy c·∫≠p:</strong> Ch·ªâ ADMIN m·ªõi ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng ch·ª©c nƒÉng n√†y</li>
                        <li><strong>Backup Job:</strong> Ch·∫°y script <code>/home/oracle/backup_web/scripts/run_rman_backup.sh</code></li>
                        <li><strong>Restore Job:</strong> Ch·∫°y script <code>/home/oracle/backup_web/scripts/run_rman_restore.sh</code></li>
                        <li><strong>L∆∞u √Ω:</strong> C√°c job ƒë∆∞·ª£c th·ª±c thi th√¥ng qua DBMS_SCHEDULER v√† c√≥ th·ªÉ m·∫•t th·ªùi gian t√πy thu·ªôc v√†o k√≠ch th∆∞·ªõc d·ªØ li·ªáu</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function confirmRestore() {
        return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ch·∫°y Restore? Thao t√°c n√†y c√≥ th·ªÉ ghi ƒë√® d·ªØ li·ªáu hi·ªán t·∫°i. Nh·∫•n OK ƒë·ªÉ ti·∫øp t·ª•c.');
    }

    // Disable buttons on submit to prevent double-click
    document.getElementById('backupForm')?.addEventListener('submit', function() {
        const btn = document.getElementById('btnBackup');
        if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ƒêang x·ª≠ l√Ω...';
        }
    });

    document.getElementById('restoreForm')?.addEventListener('submit', function() {
        const btn = document.getElementById('btnRestore');
        if (btn) {
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>ƒêang x·ª≠ l√Ω...';
        }
    });
</script>

<style>
    .card {
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .btn-lg {
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
    }
</style>

