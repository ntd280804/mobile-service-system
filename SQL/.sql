CREATE TABLE EMPLOYEE (
    EMP_ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FULL_NAME      VARCHAR2(100) NOT NULL,
    USERNAME       VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD_HASH  VARCHAR2(256) NOT NULL,
    PUBLIC_KEY     CLOB,
    CREATED_AT     TIMESTAMP DEFAULT SYSTIMESTAMP,
    EMAIL          VARCHAR2(100) UNIQUE NOT NULL,
    PHONE          VARCHAR2(20) UNIQUE NOT NULL
);

-- 1.2 Bảng CUSTOMER: thông tin khách hàng
CREATE TABLE CUSTOMER (
    PHONE         VARCHAR2(20) PRIMARY KEY,
    FULL_NAME     VARCHAR2(100) NOT NULL,
    PASSWORD_HASH VARCHAR2(256),
    PUBLIC_KEY    CLOB,
    CREATED_AT    TIMESTAMP DEFAULT SYSTIMESTAMP,
    EMAIL         VARCHAR2(100),
    ADDRESS       VARCHAR2(200)
);

-- ===========================================
-- 4. BẢNG QUẢN LÝ ORDER / 
-- ===========================================

-- 4.1 Bảng ORDERS: lưu thông tin order
CREATE TABLE ORDERS (
    ORDER_ID       NUMBER PRIMARY KEY,
    CUSTOMER_PHONE VARCHAR2(20) NOT NULL,
    RECEIVER_EMP   NUMBER NOT NULL,
	HANDLER_EMP    NUMBER NOT NULL,
    ORDER_TYPE     VARCHAR2(20) NOT NULL,
    RECEIVED_DATE  DATE NOT NULL,
    STATUS         VARCHAR2(50) NOT NULL,
    DESCRIPTION    VARCHAR2(500),
    CONSTRAINT fk_order_customer FOREIGN KEY (CUSTOMER_PHONE) REFERENCES CUSTOMER(PHONE),
    CONSTRAINT fk_order_employee FOREIGN KEY (RECEIVER_EMP) REFERENCES EMPLOYEE(EMP_ID),
	CONSTRAINT fk_order_handleemployee FOREIGN KEY (HANDLER_EMP) REFERENCES EMPLOYEE(EMP_ID)
);



-- ===========================================
-- 5. BẢNG QUẢN LÝ KHO
-- ===========================================

-- 5.1 Bảng STOCK_IN: nhập kho
CREATE TABLE STOCK_IN (
    STOCKIN_ID    NUMBER PRIMARY KEY,
    EMP_ID        NUMBER NOT NULL,
    IN_DATE       DATE NOT NULL,
    NOTE          VARCHAR2(200),
	SIGNATURE     VARCHAR2(4000),
    CONSTRAINT fk_stockin_employee FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID)
);

-- 5.2 Bảng STOCK_IN_ITEM: chi tiết nhập kho
CREATE TABLE STOCK_IN_ITEM (
    STOCKIN_ITEM_ID NUMBER PRIMARY KEY,
    STOCKIN_ID      NUMBER NOT NULL,
    PART_NAME       VARCHAR2(100) NOT NULL,
    MANUFACTURER    VARCHAR2(100),
    SERIAL          VARCHAR2(50) UNIQUE NOT NULL,
	PRICE			NUMBER(20,2),
    CONSTRAINT fk_stockinitem_stockin FOREIGN KEY (STOCKIN_ID) REFERENCES STOCK_IN(STOCKIN_ID)
);
DROP TABLE PART CASCADE CONSTRAINTS PURGE;
-- 5.3 Bảng PART: chi tiết linh kiện
CREATE TABLE PART (
    PART_ID        NUMBER PRIMARY KEY,
    NAME           VARCHAR2(100) NOT NULL,
    MANUFACTURER   VARCHAR2(100),
    SERIAL         VARCHAR2(50) UNIQUE NOT NULL,
    STATUS         VARCHAR2(50) NOT NULL,
    STOCK_IN_ID NUMBER NOT NULL,
    ORDER_ID       NUMBER NULL,
	PRICE			NUMBER(20,2),
    CONSTRAINT fk_part_stockinitem FOREIGN KEY (STOCK_IN_ID) REFERENCES STOCK_IN(STOCKIN_ID),
    CONSTRAINT fk_part_order FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID)
);

-- 5.4 Bảng STOCK_OUT: xuất kho
CREATE TABLE STOCK_OUT (
    STOCKOUT_ID   NUMBER PRIMARY KEY,
    ORDER_ID      NUMBER NOT NULL,
    EMP_ID        NUMBER NOT NULL,
    OUT_DATE      DATE NOT NULL,
    NOTE          VARCHAR2(200),
	SIGNATURE     VARCHAR2(4000),
    CONSTRAINT fk_stockout_order FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
    CONSTRAINT fk_stockout_employee FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID)
);

-- 5.5 Bảng STOCK_OUT_ITEM: chi tiết xuất kho
CREATE TABLE STOCK_OUT_ITEM (
    STOCKOUT_ITEM_ID NUMBER PRIMARY KEY,
    STOCKOUT_ID      NUMBER NOT NULL,
    PART_ID          NUMBER NOT NULL,
    CONSTRAINT fk_stockoutitem_stockout FOREIGN KEY (STOCKOUT_ID) REFERENCES STOCK_OUT(STOCKOUT_ID),
    CONSTRAINT fk_stockoutitem_part FOREIGN KEY (PART_ID) REFERENCES PART(PART_ID)
);


-- ===========================================
-- 6. BẢNG QUẢN LÝ YÊU CẦU LINH KIỆN
-- ===========================================

-- 6.1 Bảng PART_REQUEST: yêu cầu linh kiện từ order
CREATE TABLE PART_REQUEST (
    REQUEST_ID   NUMBER PRIMARY KEY,
    ORDER_ID     NUMBER NOT NULL,
    EMP_ID       NUMBER NOT NULL,
    REQUEST_DATE DATE NOT NULL,
    STATUS       VARCHAR2(50) NOT NULL,
    CONSTRAINT fk_partrequest_order FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
    CONSTRAINT fk_partrequest_employee FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID)
);

-- 6.2 Bảng PART_REQUEST_ITEM: chi tiết yêu cầu linh kiện
CREATE TABLE PART_REQUEST_ITEM (
    REQUEST_ITEM_ID NUMBER PRIMARY KEY,
    REQUEST_ID      NUMBER NOT NULL,
    PART_ID         NUMBER NOT NULL,
    CONSTRAINT fk_partrequestitem_request FOREIGN KEY (REQUEST_ID) REFERENCES PART_REQUEST(REQUEST_ID),
    CONSTRAINT fk_partrequestitem_part FOREIGN KEY (PART_ID) REFERENCES PART(PART_ID)
);


-- ===========================================
-- 7. BẢNG OTP
-- ===========================================

CREATE TABLE USER_OTP_LOG (
    ID         NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID    NUMBER NOT NULL,
    USERNAME   VARCHAR2(100) NOT NULL,
    OTP        VARCHAR2(10) NOT NULL,
    CREATED_AT TIMESTAMP DEFAULT SYSTIMESTAMP,
    EXPIRED_AT TIMESTAMP,
    USED       CHAR(1) DEFAULT 'N'
);


-- ===========================================
-- 8. BẢNG LỊCH LÀM VIỆC
-- ===========================================

CREATE TABLE EMPLOYEE_SHIFT (
    SHIFT_ID     NUMBER PRIMARY KEY,
    EMP_ID       NUMBER NOT NULL,
    SHIFT_DATE   DATE NOT NULL,
    START_TIME   TIMESTAMP NOT NULL,
    END_TIME     TIMESTAMP NOT NULL,
    STATUS       VARCHAR2(20) DEFAULT 'SCHEDULED',
    CONSTRAINT fk_shift_employee FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID)
);


-- ===========================================
-- 9. BẢNG LỊCH HẸN KHÁCH HÀNG
-- ===========================================

CREATE TABLE CUSTOMER_APPOINTMENT (
    APPOINTMENT_ID NUMBER PRIMARY KEY,
    CUSTOMER_PHONE VARCHAR2(20) NOT NULL,
    APPOINTMENT_DATE DATE NOT NULL,
    STATUS         VARCHAR2(20) DEFAULT 'SCHEDULED',
    DESCRIPTION    VARCHAR2(500),
    CONSTRAINT fk_appointment_customer FOREIGN KEY (CUSTOMER_PHONE) REFERENCES CUSTOMER(PHONE)
);

-- ===========================================
-- BẢNG HÓA ĐƠN
-- ===========================================

CREATE TABLE INVOICE (
    INVOICE_ID      NUMBER PRIMARY KEY,
    STOCKOUT_ID     NUMBER NOT NULL,            -- Liên kết với xuất kho
    CUSTOMER_PHONE  VARCHAR2(20) NOT NULL,      -- Khách hàng mua
    EMP_ID          NUMBER NOT NULL,            -- Nhân viên xuất hóa đơn
    INVOICE_DATE    DATE DEFAULT SYSDATE,
    TOTAL_AMOUNT    NUMBER(20,2) DEFAULT 0,
    STATUS          VARCHAR2(20) DEFAULT 'PENDING', -- PENDING, PAID, CANCELLED
    CONSTRAINT fk_invoice_stockout FOREIGN KEY (STOCKOUT_ID) REFERENCES STOCK_OUT(STOCKOUT_ID),
    CONSTRAINT fk_invoice_customer FOREIGN KEY (CUSTOMER_PHONE) REFERENCES CUSTOMER(PHONE),
    CONSTRAINT fk_invoice_employee FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID)
);


-- ===========================================
-- BẢNG CHI TIẾT HÓA ĐƠN
-- ===========================================

CREATE TABLE INVOICE_ITEM (
    INVOICE_ITEM_ID NUMBER PRIMARY KEY,
    INVOICE_ID      NUMBER NOT NULL,
    STOCKOUT_ITEM_ID NUMBER NOT NULL,           -- Liên kết với item xuất kho
    PART_ID         NUMBER NOT NULL,            -- Dễ truy xuất thông tin part
    PRICE           NUMBER(20,2) NOT NULL,
    CONSTRAINT fk_invoiceitem_invoice FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE(INVOICE_ID),
    CONSTRAINT fk_invoiceitem_stockoutitem FOREIGN KEY (STOCKOUT_ITEM_ID) REFERENCES STOCK_OUT_ITEM(STOCKOUT_ITEM_ID),
    CONSTRAINT fk_invoiceitem_part FOREIGN KEY (PART_ID) REFERENCES PART(PART_ID)
);

CREATE TABLE SERVICE (
    SERVICE_ID   NUMBER PRIMARY KEY,
    NAME         VARCHAR2(100) NOT NULL,
    DESCRIPTION  VARCHAR2(500),
    PRICE        NUMBER(20,2) NOT NULL
);
CREATE TABLE INVOICE_SERVICE (
    INVOICE_SERVICE_ID NUMBER PRIMARY KEY,
    INVOICE_ID         NUMBER NOT NULL,
    SERVICE_ID         NUMBER NOT NULL,
    QUANTITY           NUMBER DEFAULT 1,
    PRICE              NUMBER(20,2) NOT NULL,  -- có thể lấy từ SERVICE.PRICE hoặc custom
    CONSTRAINT fk_invoiceservice_invoice FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE(INVOICE_ID),
    CONSTRAINT fk_invoiceservice_service FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(SERVICE_ID)
);

--------------------------------------------------------
--  File created - Tuesday-November-04-2025   
--------------------------------------------------------
DROP TYPE "APP"."ODCIVARCHAR2LIST_ARRAY";
DROP SEQUENCE "APP"."APPOINTMENT_SEQ";
DROP SEQUENCE "APP"."ORDERS_SEQ";
DROP SEQUENCE "APP"."PART_REQUEST_ITEM_SEQ";
DROP SEQUENCE "APP"."PART_REQUEST_SEQ";
DROP SEQUENCE "APP"."PART_SEQ";
DROP SEQUENCE "APP"."STOCKIN_ITEM_SEQ";
DROP SEQUENCE "APP"."STOCKIN_SEQ";
DROP TABLE "APP"."CREATE$JAVA$LOB$TABLE" cascade constraints;
DROP TABLE "APP"."CUSTOMER" cascade constraints;
DROP TABLE "APP"."CUSTOMER_APPOINTMENT" cascade constraints;
DROP TABLE "APP"."EMPLOYEE" cascade constraints;
DROP TABLE "APP"."EMPLOYEE_SHIFT" cascade constraints;
DROP TABLE "APP"."INVOICE" cascade constraints;
DROP TABLE "APP"."INVOICE_ITEM" cascade constraints;
DROP TABLE "APP"."ORDERS" cascade constraints;
DROP TABLE "APP"."PART" cascade constraints;
DROP TABLE "APP"."PART_REQUEST" cascade constraints;
DROP TABLE "APP"."PART_REQUEST_ITEM" cascade constraints;
DROP TABLE "APP"."STOCK_IN" cascade constraints;
DROP TABLE "APP"."STOCK_IN_ITEM" cascade constraints;
DROP TABLE "APP"."STOCK_OUT" cascade constraints;
DROP TABLE "APP"."STOCK_OUT_ITEM" cascade constraints;
DROP TABLE "APP"."USER_OTP_LOG" cascade constraints;
DROP PROCEDURE "APP"."ACCEPT_PART_REQUEST";
DROP PROCEDURE "APP"."ASSIGN_PROFILE_TO_USER";
DROP PROCEDURE "APP"."ASSIGN_ROLE_PROC";
DROP PROCEDURE "APP"."COMPLETE_PART_REQUEST";
DROP PROCEDURE "APP"."CREATE_APPOINTMENT";
DROP PROCEDURE "APP"."CREATE_ORDER";
DROP PROCEDURE "APP"."CREATE_PART";
DROP PROCEDURE "APP"."CREATE_PART_REQUEST";
DROP PROCEDURE "APP"."CREATE_PART_REQUEST_ITEM";
DROP PROCEDURE "APP"."CREATE_PROFILE";
DROP PROCEDURE "APP"."CREATE_ROLE_PROC";
DROP PROCEDURE "APP"."CREATE_STOCKIN";
DROP PROCEDURE "APP"."CREATE_STOCKIN_ITEM";
DROP PROCEDURE "APP"."DELETE_PROFILE";
DROP PROCEDURE "APP"."DELETE_ROLE_PROC";
DROP PROCEDURE "APP"."DENY_PART_REQUEST";
DROP PROCEDURE "APP"."ENCRYPT_PASSWORD_FOR_EMPLOYEE";
DROP PROCEDURE "APP"."GET_ALL_APPOINTMENTS";
DROP PROCEDURE "APP"."GET_ALL_CUSTOMERS";
DROP PROCEDURE "APP"."GET_ALL_EMPLOYEES";
DROP PROCEDURE "APP"."GET_ALL_IMPORTS";
DROP PROCEDURE "APP"."GET_ALL_ORDERS";
DROP PROCEDURE "APP"."GET_ALL_PART";
DROP PROCEDURE "APP"."GET_ALL_PART_IN_STOCK";
DROP PROCEDURE "APP"."GET_ALL_PART_REQUESTS";
DROP PROCEDURE "APP"."GET_ALL_PROFILES_WITH_LIMITS";
DROP PROCEDURE "APP"."GET_ALL_ROLES";
DROP PROCEDURE "APP"."GET_ALL_USERS";
DROP PROCEDURE "APP"."GET_ALL_USERS_WITH_PROFILE";
DROP PROCEDURE "APP"."GET_BY_ORDER_TYPE";
DROP PROCEDURE "APP"."GET_EMPLOYEE_BY_ID";
DROP PROCEDURE "APP"."GET_EMPLOYEE_ID_BY_USERNAME";
DROP PROCEDURE "APP"."GET_EMPLOYEE_NAME_BY_ID";
DROP PROCEDURE "APP"."GET_EMPLOYEE_PUBLIC_KEY";
DROP PROCEDURE "APP"."GET_EMP_ID_FROM_STOCKIN";
DROP PROCEDURE "APP"."GET_IMPORT_BY_ID";
DROP PROCEDURE "APP"."GET_ORDER_BY_ID";
DROP PROCEDURE "APP"."GET_PART_BY_ORDERID";
DROP PROCEDURE "APP"."GET_PART_BY_SERIAL";
DROP PROCEDURE "APP"."GET_PART_BY_STATUS";
DROP PROCEDURE "APP"."GET_PART_BY_STOCK";
DROP PROCEDURE "APP"."GET_PART_BY_STOCKINID";
DROP PROCEDURE "APP"."GET_PROFILE_BY_NAME";
DROP PROCEDURE "APP"."GET_ROLES_OF_USER";
DROP PROCEDURE "APP"."GET_STOCKIN_SIGNATURE";
DROP PROCEDURE "APP"."GET_UNFINISHED_ORDERS";
DROP PROCEDURE "APP"."LOCK_DB_USER";
DROP PROCEDURE "APP"."LOGIN_CUSTOMER";
DROP PROCEDURE "APP"."LOGIN_EMPLOYEE";
DROP PROCEDURE "APP"."REGISTER_CUSTOMER";
DROP PROCEDURE "APP"."REGISTER_EMPLOYEE";
DROP PROCEDURE "APP"."REVOKE_ROLE_PROC";
DROP PROCEDURE "APP"."SIGN_STOCKIN";
DROP PROCEDURE "APP"."UNLOCK_DB_USER";
DROP PROCEDURE "APP"."UPDATE_ORDER_STATUS_WAIT_PART";
DROP PROCEDURE "APP"."UPDATE_STOCKIN_SIGNATURE";
DROP PROCEDURE "APP"."VERIFY_STOCKIN_SIGNATURE";
DROP FUNCTION "APP"."HASH_PASSWORD";
DROP FUNCTION "APP"."HASH_PASSWORD_20CHARS";
DROP PACKAGE "APP"."APP_CTX_PKG";
DROP PACKAGE "APP"."CRYPTO";
DROP PACKAGE BODY "APP"."APP_CTX_PKG";
DROP FUNCTION "APP"."APPOINTMENT_VPD_PREDICATE";
DROP FUNCTION "APP"."APPOINTMENT_VPD_PREDICATE_DEL";
DROP FUNCTION "APP"."ORDERS_VPD_PREDICATE";
DROP FUNCTION "APP"."ORDERS_VPD_PREDICATE_DEL";
DROP FUNCTION "APP"."ORDERS_VPD_PREDICATE_UPD";
--------------------------------------------------------
--  DDL for Type ODCIVARCHAR2LIST_ARRAY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TYPE "APP"."ODCIVARCHAR2LIST_ARRAY" AS TABLE OF VARCHAR2(4000);

/
--------------------------------------------------------
--  DDL for Sequence APPOINTMENT_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."APPOINTMENT_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 8 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence ORDERS_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."ORDERS_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 81 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence PART_REQUEST_ITEM_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."PART_REQUEST_ITEM_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 11 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence PART_REQUEST_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."PART_REQUEST_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 23 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence PART_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."PART_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 296 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence STOCKIN_ITEM_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."STOCKIN_ITEM_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 299 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence STOCKIN_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "APP"."STOCKIN_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 30 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Table CREATE$JAVA$LOB$TABLE
--------------------------------------------------------

  CREATE TABLE "APP"."CREATE$JAVA$LOB$TABLE" 
   (	"NAME" VARCHAR2(700 BYTE), 
	"LOB" BLOB, 
	"LOADTIME" DATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" 
 LOB ("LOB") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table CUSTOMER
--------------------------------------------------------

  CREATE TABLE "APP"."CUSTOMER" 
   (	"PHONE" VARCHAR2(20 BYTE), 
	"FULL_NAME" VARCHAR2(100 BYTE), 
	"PASSWORD_HASH" VARCHAR2(256 BYTE), 
	"PUBLIC_KEY" CLOB, 
	"STATUS" VARCHAR2(10 BYTE) DEFAULT 'ACTIVE', 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP, 
	"EMAIL" VARCHAR2(100 BYTE), 
	"ADDRESS" VARCHAR2(200 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" 
 LOB ("PUBLIC_KEY") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table CUSTOMER_APPOINTMENT
--------------------------------------------------------

  CREATE TABLE "APP"."CUSTOMER_APPOINTMENT" 
   (	"APPOINTMENT_ID" NUMBER, 
	"CUSTOMER_PHONE" VARCHAR2(20 BYTE), 
	"APPOINTMENT_DATE" DATE, 
	"STATUS" VARCHAR2(20 BYTE) DEFAULT 'SCHEDULED', 
	"DESCRIPTION" VARCHAR2(500 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table EMPLOYEE
--------------------------------------------------------

  CREATE TABLE "APP"."EMPLOYEE" 
   (	"EMP_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"FULL_NAME" VARCHAR2(100 BYTE), 
	"USERNAME" VARCHAR2(50 BYTE), 
	"PASSWORD_HASH" VARCHAR2(256 BYTE), 
	"PUBLIC_KEY" CLOB, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP, 
	"EMAIL" VARCHAR2(100 BYTE), 
	"PHONE" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" 
 LOB ("PUBLIC_KEY") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW 4000 CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 262144 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
  GRANT SELECT ON "APP"."EMPLOYEE" TO "ADMIN1";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "ADMIN1";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "TIEPTAN1";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "TIEPTAN1";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "ADMIN2";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "ADMIN2";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "ADMIN3";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "ADMIN3";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "ADMIN4";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "ADMIN4";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "ABC1";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "ABC1";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "A";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "A";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "B";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "B";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "Q";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "Q";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "WE";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "WE";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "AQ";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "AQ";
  GRANT UPDATE ON "APP"."EMPLOYEE" TO "C";
  GRANT SELECT ON "APP"."EMPLOYEE" TO "C";
--------------------------------------------------------
--  DDL for Table EMPLOYEE_SHIFT
--------------------------------------------------------

  CREATE TABLE "APP"."EMPLOYEE_SHIFT" 
   (	"SHIFT_ID" NUMBER, 
	"EMP_ID" NUMBER, 
	"SHIFT_DATE" DATE, 
	"START_TIME" TIMESTAMP (6), 
	"END_TIME" TIMESTAMP (6), 
	"STATUS" VARCHAR2(20 BYTE) DEFAULT 'SCHEDULED'
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table INVOICE
--------------------------------------------------------

  CREATE TABLE "APP"."INVOICE" 
   (	"INVOICE_ID" NUMBER, 
	"STOCKOUT_ID" NUMBER, 
	"CUSTOMER_PHONE" VARCHAR2(20 BYTE), 
	"EMP_ID" NUMBER, 
	"INVOICE_DATE" DATE DEFAULT SYSDATE, 
	"TOTAL_AMOUNT" NUMBER(20,2) DEFAULT 0, 
	"STATUS" VARCHAR2(20 BYTE) DEFAULT 'PENDING'
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table INVOICE_ITEM
--------------------------------------------------------

  CREATE TABLE "APP"."INVOICE_ITEM" 
   (	"INVOICE_ITEM_ID" NUMBER, 
	"INVOICE_ID" NUMBER, 
	"STOCKOUT_ITEM_ID" NUMBER, 
	"PART_ID" NUMBER, 
	"PRICE" NUMBER(20,2)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table ORDERS
--------------------------------------------------------

  CREATE TABLE "APP"."ORDERS" 
   (	"ORDER_ID" NUMBER, 
	"CUSTOMER_PHONE" VARCHAR2(20 BYTE), 
	"RECEIVER_EMP" NUMBER, 
	"ORDER_TYPE" VARCHAR2(20 BYTE), 
	"RECEIVED_DATE" DATE, 
	"STATUS" VARCHAR2(50 BYTE), 
	"DESCRIPTION" VARCHAR2(500 BYTE), 
	"HANDLER_EMP" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
  GRANT SELECT ON "APP"."ORDERS" TO "ROLE_TIEPTAN";
  GRANT SELECT ON "APP"."ORDERS" TO "ROLE_ADMIN";
  GRANT SELECT ON "APP"."ORDERS" TO "ROLE_THUKHO";
  GRANT SELECT ON "APP"."ORDERS" TO "ROLE_KITHUATVIEN";
  GRANT SELECT ON "APP"."ORDERS" TO "ROLE_KHACHHANG";
--------------------------------------------------------
--  DDL for Table PART
--------------------------------------------------------

  CREATE TABLE "APP"."PART" 
   (	"PART_ID" NUMBER, 
	"NAME" VARCHAR2(100 BYTE), 
	"MANUFACTURER" VARCHAR2(100 BYTE), 
	"SERIAL" VARCHAR2(50 BYTE), 
	"STATUS" VARCHAR2(50 BYTE), 
	"ORDER_ID" NUMBER, 
	"PRICE" NUMBER(20,2), 
	"STOCK_IN_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table PART_REQUEST
--------------------------------------------------------

  CREATE TABLE "APP"."PART_REQUEST" 
   (	"REQUEST_ID" NUMBER, 
	"ORDER_ID" NUMBER, 
	"EMP_ID" NUMBER, 
	"REQUEST_DATE" DATE, 
	"STATUS" VARCHAR2(50 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table PART_REQUEST_ITEM
--------------------------------------------------------

  CREATE TABLE "APP"."PART_REQUEST_ITEM" 
   (	"REQUEST_ITEM_ID" NUMBER, 
	"REQUEST_ID" NUMBER, 
	"PART_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table STOCK_IN
--------------------------------------------------------

  CREATE TABLE "APP"."STOCK_IN" 
   (	"STOCKIN_ID" NUMBER, 
	"EMP_ID" NUMBER, 
	"IN_DATE" DATE, 
	"NOTE" VARCHAR2(200 BYTE), 
	"SIGNATURE" VARCHAR2(4000 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table STOCK_IN_ITEM
--------------------------------------------------------

  CREATE TABLE "APP"."STOCK_IN_ITEM" 
   (	"STOCKIN_ITEM_ID" NUMBER, 
	"STOCKIN_ID" NUMBER, 
	"PART_NAME" VARCHAR2(100 BYTE), 
	"MANUFACTURER" VARCHAR2(100 BYTE), 
	"SERIAL" VARCHAR2(50 BYTE), 
	"PRICE" NUMBER(20,2)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table STOCK_OUT
--------------------------------------------------------

  CREATE TABLE "APP"."STOCK_OUT" 
   (	"STOCKOUT_ID" NUMBER, 
	"ORDER_ID" NUMBER, 
	"EMP_ID" NUMBER, 
	"OUT_DATE" DATE, 
	"NOTE" VARCHAR2(200 BYTE), 
	"SIGNATURE" VARCHAR2(4000 BYTE)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table STOCK_OUT_ITEM
--------------------------------------------------------

  CREATE TABLE "APP"."STOCK_OUT_ITEM" 
   (	"STOCKOUT_ITEM_ID" NUMBER, 
	"STOCKOUT_ID" NUMBER, 
	"PART_ID" NUMBER
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table USER_OTP_LOG
--------------------------------------------------------

  CREATE TABLE "APP"."USER_OTP_LOG" 
   (	"ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"USER_ID" NUMBER, 
	"USERNAME" VARCHAR2(100 BYTE), 
	"OTP" VARCHAR2(10 BYTE), 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP, 
	"EXPIRED_AT" TIMESTAMP (6), 
	"USED" CHAR(1 BYTE) DEFAULT 'N'
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
REM INSERTING into APP.CREATE$JAVA$LOB$TABLE
SET DEFINE OFF;
REM INSERTING into APP.CUSTOMER
SET DEFINE OFF;
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('5','A','559AEAD08264D5795D3909718CDD05ABD49572E84FE55590EEF31A88A08FDFFD','ACTIVE',to_timestamp('20-OCT-25 11.45.33.707791000 AM','DD-MON-RR HH.MI.SSXFF AM'),'A@gmail.com','A');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('0332880207','abc','BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD','ACTIVE',to_timestamp('16-OCT-25 06.06.19.788865000 AM','DD-MON-RR HH.MI.SSXFF AM'),'abc@gmail.com','371aaaa');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('0583118314','abc','BA7816BF8F01CFEA414140DE5DAE2223B00361A396177A9CB410FF61F20015AD','ACTIVE',to_timestamp('16-OCT-25 06.07.36.422827000 AM','DD-MON-RR HH.MI.SSXFF AM'),'abc1@gmail.com','123');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('123','123','A665A45920422F9D417E4867EFDC4FB8A04A1F3FFF1FA07E998E86F7F7A27AE3','ACTIVE',to_timestamp('19-OCT-25 10.01.52.310431000 AM','DD-MON-RR HH.MI.SSXFF AM'),'123@gmail.com','123');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('1234','1234','03AC674216F3E15C761EE1A5E255F067953623C8B388B4459E13F978D7C846F4','ACTIVE',to_timestamp('19-OCT-25 10.03.39.057941000 AM','DD-MON-RR HH.MI.SSXFF AM'),'1234@gmail.com','1234');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('123456','ABC','B5D4045C3F466FA91FE2CC6ABE79232A1A57CDF104F7A26E716E0A1E2789DF78','ACTIVE',to_timestamp('30-OCT-25 08.31.31.874498000 AM','DD-MON-RR HH.MI.SSXFF AM'),'ABC@gmail.com','ABC');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('0332880222','Dinh','7474B299BA431E47CCC6F3B9EB3752FFE4445BDA4D991BA94F53EBA0F21F8C1B','ACTIVE',to_timestamp('29-OCT-25 01.30.28.797179000 PM','DD-MON-RR HH.MI.SSXFF AM'),'Dinh@gmail.com','0332880222');
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('0911','KH A',null,'ACTIVE',to_timestamp('03-NOV-25 08.06.01.926444000 AM','DD-MON-RR HH.MI.SSXFF AM'),null,null);
Insert into APP.CUSTOMER (PHONE,FULL_NAME,PASSWORD_HASH,STATUS,CREATED_AT,EMAIL,ADDRESS) values ('0912','KH B',null,'ACTIVE',to_timestamp('03-NOV-25 08.06.01.937093000 AM','DD-MON-RR HH.MI.SSXFF AM'),null,null);
REM INSERTING into APP.CUSTOMER_APPOINTMENT
SET DEFINE OFF;
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (6,'0332880207',to_date('08-NOV-25','DD-MON-RR'),'SCHEDULED','A');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (1,'5',to_date('27-OCT-25','DD-MON-RR'),'SCHEDULED','A');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (2,'5',to_date('28-OCT-25','DD-MON-RR'),'SCHEDULED','ABC');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (3,'5',to_date('29-OCT-25','DD-MON-RR'),'SCHEDULED','Test');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (4,'5',to_date('31-OCT-25','DD-MON-RR'),'SCHEDULED','ABC');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (5,'5',to_date('08-NOV-25','DD-MON-RR'),'SCHEDULED','Test');
Insert into APP.CUSTOMER_APPOINTMENT (APPOINTMENT_ID,CUSTOMER_PHONE,APPOINTMENT_DATE,STATUS,DESCRIPTION) values (7,'5',to_date('28-NOV-25','DD-MON-RR'),'SCHEDULED','A');
REM INSERTING into APP.EMPLOYEE
SET DEFINE OFF;
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (1,'Admin1','Admin1','0AFB00138D8E73348EC1FE41FD3D3A8FCBD90156B263BFA5791BA0E095F42CFC',to_timestamp('16-OCT-25 05.51.45.189478000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin1@example.com','0909123456');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (2,'Nguyễn Trần Qiang','Tieptan1','D78ACC7C4CB41047239B0FEE9F5176644AB065FA488ACFC66B0BBD13D4F3768B',to_timestamp('16-OCT-25 05.51.54.137427000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Tieptan1@gmail.com','1234567890');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (6,'Admin2','Admin2','0A7E44CEEF76BDB001C9DB079D5DE4CD3FC583D6A67338863A764F454C3811C4',to_timestamp('16-OCT-25 05.55.40.641940000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin2@example.com','0909523456');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (161,'Nguyen tran dinh','Admin30','B8227B17873F47161D1266AD876776A3E894F27F5F8871B47D607BDB65D92B12',to_timestamp('29-OCT-25 10.20.18.008279000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin30@gmail.com','0332880204');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (41,'ABC','Admin4','CEC0F51A767107CABF9DCED5F17C60E60BD4858DB0019681BA69CCFC28112488',to_timestamp('19-OCT-25 07.20.07.143408000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin4@gmail.com','1234567898');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (42,'ABC','ABC1','B5D4045C3F466FA91FE2CC6ABE79232A1A57CDF104F7A26E716E0A1E2789DF78',to_timestamp('19-OCT-25 08.16.38.949143000 AM','DD-MON-RR HH.MI.SSXFF AM'),'ABC@gmai.com','1234567876');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (81,'Q','Q','4AE81572F06E1B88FD5CED7A1A000945432E83E1551E6F721EE9C00B8CC33260',to_timestamp('20-OCT-25 04.38.22.790925000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Q@gmail.com','123');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (201,'Admin21','Admin21','CF08D59FC1227391CDC5F8F1A822DE92BC5D31D1FDDE0FC1EBA4A2812254CA16',to_timestamp('30-OCT-25 08.38.23.334092000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin21@gmail.com','0397125044');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (21,'NguyenTranDinh','Admin3','16AEFDB4E6FEEDB53469C0210C8DEECC650E822550F743C409E00B9A4FEA1393',to_timestamp('17-OCT-25 01.07.56.574081000 AM','DD-MON-RR HH.MI.SSXFF AM'),'Admin3@gmail.com','1234567893');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (61,'A','A','559AEAD08264D5795D3909718CDD05ABD49572E84FE55590EEF31A88A08FDFFD',to_timestamp('20-OCT-25 12.10.25.400192000 AM','DD-MON-RR HH.MI.SSXFF AM'),'A@gmail.com','123456');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (62,'B','B','DF7E70E5021544F4834BBEE64A9E3789FEBC4BE81470DF629CAD6DDB03320A5C',to_timestamp('20-OCT-25 12.12.42.933732000 AM','DD-MON-RR HH.MI.SSXFF AM'),'B@gmail.com','12345');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (104,'WE','WE','49F44247CFC1FD35FAAE1F2B8B0C6F142CB93EA5F7A80C0CDECF2322888CDB5F',to_timestamp('20-OCT-25 05.31.49.622631000 AM','DD-MON-RR HH.MI.SSXFF AM'),'WE@gmail.com','12345678');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (121,'AQ','AQ','408009A0A0B7A159E64B0A9778B7F74C3818A0696CA81DCE44FA56BC089032E5',to_timestamp('20-OCT-25 11.10.12.316848000 AM','DD-MON-RR HH.MI.SSXFF AM'),'AQ@gmail.com','0951');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (141,'C','C','6B23C0D5F35D1B11F9B683F0B0A617355DEB11277D91AE091D399C655B87940D',to_timestamp('23-OCT-25 07.05.08.244714000 AM','DD-MON-RR HH.MI.SSXFF AM'),'C@gmail.com','1234567653');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (181,'Admin31','Admin31','EC04451E356B41B8A94700D94F81A8407530AB92C08B41A54AAF3D1A772C9463',to_timestamp('29-OCT-25 09.33.00.070019000 PM','DD-MON-RR HH.MI.SSXFF AM'),'Admin31@gmail.com','0332880266');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (101,'KTV A','ktv.a','x',to_timestamp('03-NOV-25 08.06.01.905792000 AM','DD-MON-RR HH.MI.SSXFF AM'),'a@x','0901');
Insert into APP.EMPLOYEE (EMP_ID,FULL_NAME,USERNAME,PASSWORD_HASH,CREATED_AT,EMAIL,PHONE) values (102,'KTV B','ktv.b','x',to_timestamp('03-NOV-25 08.06.01.916966000 AM','DD-MON-RR HH.MI.SSXFF AM'),'b@x','0902');
REM INSERTING into APP.EMPLOYEE_SHIFT
SET DEFINE OFF;
REM INSERTING into APP.INVOICE
SET DEFINE OFF;
REM INSERTING into APP.INVOICE_ITEM
SET DEFINE OFF;
REM INSERTING into APP.ORDERS
SET DEFINE OFF;
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (4,'0332880207',6,'REPAIR',to_date('22-OCT-25','DD-MON-RR'),'Đang chờ linh kiện','Test',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (5,'0332880207',6,'REPAIR',to_date('22-OCT-25','DD-MON-RR'),'Đang chờ linh kiện','TEST',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (41,'0583118314',6,'REPAIR',to_date('31-OCT-25','DD-MON-RR'),'Đã tiếp nhận','Sửa kính lưng iphone xs trắng',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (61,'0332880207',6,'REPAIR',to_date('04-NOV-25','DD-MON-RR'),'Đã tiếp nhận','Test',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (42,'0583118314',6,'REPAIR',to_date('01-NOV-25','DD-MON-RR'),'Đã tiếp nhận','ABC',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (3,'0332880207',1,'REPAIR',to_date('22-OCT-25','DD-MON-RR'),'Đang chờ linh kiện','Đơn hàng thử',1);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (21,'0332880207',6,'REPAIR',to_date('29-OCT-25','DD-MON-RR'),'Đang chờ linh kiện','Sửa mặt lưng kính trắng cho iphone xs',6);
Insert into APP.ORDERS (ORDER_ID,CUSTOMER_PHONE,RECEIVER_EMP,ORDER_TYPE,RECEIVED_DATE,STATUS,DESCRIPTION,HANDLER_EMP) values (43,'5',6,'REPAIR',to_date('01-NOV-25','DD-MON-RR'),'Đã tiếp nhận','test',6);
REM INSERTING into APP.PART
SET DEFINE OFF;
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (276,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-1','ASSIGNED',21,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (277,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-2','ASSIGNED',4,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (278,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-3','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (279,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-4','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (280,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-5','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (281,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-6','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (282,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-7','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (283,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-8','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (284,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-9','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (285,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-10','IN_STOCK',null,10000,28);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (175,'Cường lực Iphone XS','APPLE','IphoneXS-1','USED',null,100000,26);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (286,'CLXS','Apple','CLXS-1','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (287,'CLXS','Apple','CLXS-2','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (288,'CLXS','Apple','CLXS-3','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (289,'CLXS','Apple','CLXS-4','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (290,'CLXS','Apple','CLXS-5','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (291,'CLXS','Apple','CLXS-6','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (292,'CLXS','Apple','CLXS-7','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (293,'CLXS','Apple','CLXS-8','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (294,'CLXS','Apple','CLXS-9','IN_STOCK',null,10000,29);
Insert into APP.PART (PART_ID,NAME,MANUFACTURER,SERIAL,STATUS,ORDER_ID,PRICE,STOCK_IN_ID) values (295,'CLXS','Apple','CLXS-10','IN_STOCK',null,10000,29);
REM INSERTING into APP.PART_REQUEST
SET DEFINE OFF;
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (1,3,6,to_date('23-OCT-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (9,4,6,to_date('29-OCT-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (17,4,6,to_date('29-OCT-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (18,4,6,to_date('29-OCT-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (19,4,6,to_date('30-OCT-25','DD-MON-RR'),'ACCEPT');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (21,21,6,to_date('30-OCT-25','DD-MON-RR'),'ACCEPT');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (16,4,6,to_date('29-OCT-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (22,42,6,to_date('01-NOV-25','DD-MON-RR'),'DENY');
Insert into APP.PART_REQUEST (REQUEST_ID,ORDER_ID,EMP_ID,REQUEST_DATE,STATUS) values (20,3,6,to_date('30-OCT-25','DD-MON-RR'),'DENY');
REM INSERTING into APP.PART_REQUEST_ITEM
SET DEFINE OFF;
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (1,9,175);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (3,17,276);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (4,17,278);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (5,18,276);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (6,18,278);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (7,19,277);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (9,21,276);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (2,16,175);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (10,22,278);
Insert into APP.PART_REQUEST_ITEM (REQUEST_ITEM_ID,REQUEST_ID,PART_ID) values (8,20,278);
REM INSERTING into APP.STOCK_IN
SET DEFINE OFF;
Insert into APP.STOCK_IN (STOCKIN_ID,EMP_ID,IN_DATE,NOTE,SIGNATURE) values (28,6,to_date('29-OCT-25','DD-MON-RR'),'Nhập 10 cái mặt lưng iphone xs trắng','T2+yJS64tbcuQ2caXwFxf7r/MrN2Ufq84FBGGr/yz4qXJtauFBCvc+3skLi4HRXPUikI0JJgr/drh6ziRL0iJ+S3eNiQBrHPsXyqlYM+rZ0+P36YXhwewvvt9W5JIYvB7t/Naei0HmZA104A/ZJKDMoWJxgwlj74mcEufl/fq6o=');
Insert into APP.STOCK_IN (STOCKIN_ID,EMP_ID,IN_DATE,NOTE,SIGNATURE) values (26,6,to_date('29-OCT-25','DD-MON-RR'),'Nhập 1 kính cường lực iphoneXS','KsfI5LDyBEaLerLcxAsScUhp4Q5bvF6hkpeZfxAjzbNAqFzXWW8sg74C9QN025GkzxViqEMgEyLS/aQm6u9jfiMn6O/LloeBx9Mvx0oXtk4/Vy9tZ57WLNYjHTHd3NR4yv/hSjrllCD5oafuDIRPygGuxKMp7PxPCyoFWvrG6sU=');
Insert into APP.STOCK_IN (STOCKIN_ID,EMP_ID,IN_DATE,NOTE,SIGNATURE) values (29,6,to_date('29-OCT-25','DD-MON-RR'),'Nhập lô 10 cái cường lực','Jgaxo9IOIIk4vxj6KdW3xfwNN/r33PkHXKmfZee2q0Ozn7w2UMXP/kYz5kgwGR3mzWZ9borvPdB0Iqu6UGpQM4b/t6fjySZMpd6uG92ldRPayKaoJlHnIQuQcrYnf/GIBCeWsqxUG8MSpAflZIOaRA2bVrNur0fxzYwIxviUMOQ=');
REM INSERTING into APP.STOCK_IN_ITEM
SET DEFINE OFF;
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (279,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-1',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (280,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-2',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (281,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-3',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (282,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-4',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (283,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-5',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (284,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-6',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (285,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-7',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (286,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-8',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (287,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-9',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (288,28,'Mặt lưng kính IP XS trắng','Apple','MLK_XS-10',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (178,26,'Cường lực Iphone XS','APPLE','IphoneXS-1',100000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (289,29,'CLXS','Apple','CLXS-1',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (290,29,'CLXS','Apple','CLXS-2',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (291,29,'CLXS','Apple','CLXS-3',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (292,29,'CLXS','Apple','CLXS-4',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (293,29,'CLXS','Apple','CLXS-5',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (294,29,'CLXS','Apple','CLXS-6',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (295,29,'CLXS','Apple','CLXS-7',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (296,29,'CLXS','Apple','CLXS-8',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (297,29,'CLXS','Apple','CLXS-9',10000);
Insert into APP.STOCK_IN_ITEM (STOCKIN_ITEM_ID,STOCKIN_ID,PART_NAME,MANUFACTURER,SERIAL,PRICE) values (298,29,'CLXS','Apple','CLXS-10',20000);
REM INSERTING into APP.STOCK_OUT
SET DEFINE OFF;
REM INSERTING into APP.STOCK_OUT_ITEM
SET DEFINE OFF;
REM INSERTING into APP.USER_OTP_LOG
SET DEFINE OFF;
--------------------------------------------------------
--  DDL for Procedure ACCEPT_PART_REQUEST
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."ACCEPT_PART_REQUEST" (
    p_request_id IN NUMBER
)
AS
BEGIN
    -- 1. Cập nhật trạng thái request
    UPDATE PART_REQUEST
    SET STATUS = 'ACCEPT'
    WHERE REQUEST_ID = p_request_id;

    -- 2. Cập nhật tất cả part dựa trên request items
    UPDATE PART p
       SET STATUS = 'ASSIGNED',
           ORDER_ID = (SELECT pr.ORDER_ID
                       FROM PART_REQUEST pr
                      WHERE pr.REQUEST_ID = p_request_id)
     WHERE p.PART_ID IN (SELECT pri.PART_ID
                           FROM PART_REQUEST_ITEM pri
                          WHERE pri.REQUEST_ID = p_request_id);

    COMMIT;
END ACCEPT_PART_REQUEST;

/

  GRANT EXECUTE ON "APP"."ACCEPT_PART_REQUEST" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure ASSIGN_PROFILE_TO_USER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."ASSIGN_PROFILE_TO_USER" (
    p_username IN VARCHAR2,
    p_profile_name IN VARCHAR2
)
AS
BEGIN
    EXECUTE IMMEDIATE 'ALTER USER "' || p_username || '" PROFILE "' || UPPER(p_profile_name) || '"';
END ASSIGN_PROFILE_TO_USER;

/

  GRANT EXECUTE ON "APP"."ASSIGN_PROFILE_TO_USER" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure ASSIGN_ROLE_PROC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."ASSIGN_ROLE_PROC" (
    p_username IN VARCHAR2,
    p_role_name IN VARCHAR2
)
AS
BEGIN
    EXECUTE IMMEDIATE 'GRANT "' || p_role_name || '" TO "' || p_username || '"';
END;

/

  GRANT EXECUTE ON "APP"."ASSIGN_ROLE_PROC" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure COMPLETE_PART_REQUEST
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."COMPLETE_PART_REQUEST" (
    p_request_id IN NUMBER
)
AS
BEGIN
    -- 1. Cập nhật trạng thái request
    UPDATE PART_REQUEST
    SET STATUS = 'DENY'
    WHERE REQUEST_ID = p_request_id;

    -- 2. Cập nhật tất cả part dựa trên request items
    UPDATE PART p
       SET STATUS = 'ASSIGNED',
           ORDER_ID = (SELECT pr.ORDER_ID
                       FROM PART_REQUEST pr
                      WHERE pr.REQUEST_ID = p_request_id)
     WHERE p.PART_ID IN (SELECT pri.PART_ID
                           FROM PART_REQUEST_ITEM pri
                          WHERE pri.REQUEST_ID = p_request_id);

    COMMIT;
END COMPLETE_PART_REQUEST;

/

  GRANT EXECUTE ON "APP"."COMPLETE_PART_REQUEST" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_APPOINTMENT
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_APPOINTMENT" (
    p_customer_phone IN VARCHAR2,
    p_appointment_date IN DATE,
    p_description IN VARCHAR2 DEFAULT NULL,
    p_status OUT VARCHAR2
)
AS
BEGIN
    INSERT INTO CUSTOMER_APPOINTMENT (
        APPOINTMENT_ID,
        CUSTOMER_PHONE,
        APPOINTMENT_DATE,
        STATUS,
        DESCRIPTION
    )
    VALUES (
        APPOINTMENT_SEQ.NEXTVAL,  -- giả sử bạn có sequence APPOINTMENT_SEQ
        p_customer_phone,
        p_appointment_date,
        'SCHEDULED',  -- mặc định trạng thái
        p_description
    );

    p_status := 'SCHEDULED';

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE_APPLICATION_ERROR(-20001, 'Không thể tạo lịch: ' || SQLERRM);
END;

/

  GRANT EXECUTE ON "APP"."CREATE_APPOINTMENT" TO "ADMIN2";
  GRANT EXECUTE ON "APP"."CREATE_APPOINTMENT" TO "5";
--------------------------------------------------------
--  DDL for Procedure CREATE_ORDER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_ORDER" (
    p_customer_phone      IN VARCHAR2,
    p_receiver_emp_name   IN VARCHAR2,
    p_handler_emp_name    IN VARCHAR2,
    p_order_type          IN VARCHAR2,
    p_status              IN VARCHAR2,
    p_description         IN VARCHAR2 DEFAULT NULL
)
AS
    v_receiver_emp_id  EMPLOYEE.EMP_ID%TYPE;
    v_handler_emp_id   EMPLOYEE.EMP_ID%TYPE;
BEGIN
    -- Lấy EMP_ID từ username
    SELECT EMP_ID 
      INTO v_receiver_emp_id
      FROM EMPLOYEE
     WHERE USERNAME = p_receiver_emp_name;

    SELECT EMP_ID 
      INTO v_handler_emp_id
      FROM EMPLOYEE
     WHERE USERNAME = p_handler_emp_name;

    -- Insert đơn hàng, dùng SYSDATE cho received_date
    INSERT INTO ORDERS (
        ORDER_ID,
        CUSTOMER_PHONE,
        RECEIVER_EMP,
        HANDLER_EMP,
        ORDER_TYPE,
        RECEIVED_DATE,
        STATUS,
        DESCRIPTION
    ) VALUES (
        ORDERS_SEQ.NEXTVAL,
        p_customer_phone,
        v_receiver_emp_id,
        v_handler_emp_id,
        p_order_type,
        SYSDATE,              -- tự động lấy ngày hiện tại
        p_status,
        p_description
    );

    COMMIT;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        ROLLBACK;
        RAISE_APPLICATION_ERROR(-20001, 'Username không tồn tại trong bảng EMPLOYEE.');
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END CREATE_ORDER;

/

  GRANT EXECUTE ON "APP"."CREATE_ORDER" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_PART
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_PART" (
    p_stockin_id IN NUMBER,
    p_part_name IN VARCHAR2,
    p_manufacturer IN VARCHAR2,
    p_serial IN VARCHAR2,
    p_price IN NUMBER       -- thêm tham số price
)
AS
BEGIN
    INSERT INTO APP.PART (
        PART_ID, NAME, MANUFACTURER, SERIAL, STATUS, STOCK_IN_ID, PRICE
    )
    VALUES (
        PART_SEQ.NEXTVAL, p_part_name, p_manufacturer, p_serial, 'IN_STOCK', p_stockin_id, p_price
    );
END CREATE_PART;

/

  GRANT EXECUTE ON "APP"."CREATE_PART" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_PART_REQUEST
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_PART_REQUEST" (
    p_order_id     IN NUMBER,
    p_emp_id       IN NUMBER,
    p_status       IN VARCHAR2,
    p_request_date IN DATE,       -- nhận từ C#
    p_request_id   OUT NUMBER
)
AS
BEGIN
    INSERT INTO PART_REQUEST (REQUEST_ID, ORDER_ID, EMP_ID, REQUEST_DATE, STATUS)
    VALUES (PART_REQUEST_SEQ.NEXTVAL, p_order_id, p_emp_id, p_request_date, p_status)
    RETURNING REQUEST_ID INTO p_request_id;
END;

/

  GRANT EXECUTE ON "APP"."CREATE_PART_REQUEST" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_PART_REQUEST_ITEM
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_PART_REQUEST_ITEM" (
        p_request_id IN NUMBER,
        p_part_id    IN NUMBER,
        p_request_item_id OUT NUMBER
    )
    AS
    BEGIN
        INSERT INTO PART_REQUEST_ITEM (REQUEST_ITEM_ID, REQUEST_ID, PART_ID)
        VALUES (PART_REQUEST_ITEM_SEQ.NEXTVAL, p_request_id, p_part_id)
        RETURNING REQUEST_ITEM_ID INTO p_request_item_id;
    
    END;

/

  GRANT EXECUTE ON "APP"."CREATE_PART_REQUEST_ITEM" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_PROFILE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_PROFILE" (
    p_profile_name IN VARCHAR2,
    p_failed_login IN VARCHAR2 DEFAULT 'UNLIMITED',
    p_life_time IN VARCHAR2 DEFAULT 'UNLIMITED',
    p_grace_time IN VARCHAR2 DEFAULT 'UNLIMITED',
    p_lock_time IN VARCHAR2 DEFAULT 'UNLIMITED'
)
AS
BEGIN
    EXECUTE IMMEDIATE 'CREATE PROFILE ' || UPPER(p_profile_name) || ' LIMIT
        FAILED_LOGIN_ATTEMPTS ' || p_failed_login || '
        PASSWORD_LIFE_TIME ' || p_life_time || '
        PASSWORD_GRACE_TIME ' || p_grace_time || '
        PASSWORD_LOCK_TIME ' || p_lock_time;
END CREATE_PROFILE;

/

  GRANT EXECUTE ON "APP"."CREATE_PROFILE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_ROLE_PROC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_ROLE_PROC" (p_role_name IN VARCHAR2)
AS
BEGIN
    EXECUTE IMMEDIATE 'CREATE ROLE "' || p_role_name || '"';
END;

/

  GRANT EXECUTE ON "APP"."CREATE_ROLE_PROC" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_STOCKIN
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_STOCKIN" (
    p_emp_id IN NUMBER,
    p_note IN VARCHAR2,
    p_signature IN VARCHAR2,
    p_stockin_id OUT NUMBER
)
AS
BEGIN
    INSERT INTO APP.STOCK_IN (STOCKIN_ID, EMP_ID, IN_DATE, NOTE, SIGNATURE)
    VALUES (STOCKIN_SEQ.NEXTVAL, p_emp_id, SYSDATE, p_note, p_signature)
    RETURNING STOCKIN_ID INTO p_stockin_id;
END CREATE_STOCKIN;

/

  GRANT EXECUTE ON "APP"."CREATE_STOCKIN" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure CREATE_STOCKIN_ITEM
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."CREATE_STOCKIN_ITEM" (
    p_stockin_id IN NUMBER,
    p_part_name IN VARCHAR2,
    p_manufacturer IN VARCHAR2,
    p_serial IN VARCHAR2,
    p_price IN NUMBER,             -- thêm tham số price
    p_stockin_item_id OUT NUMBER
)
AS
BEGIN
    INSERT INTO APP.STOCK_IN_ITEM (
        STOCKIN_ITEM_ID, STOCKIN_ID, PART_NAME, MANUFACTURER, SERIAL, PRICE
    )
    VALUES (
        STOCKIN_ITEM_SEQ.NEXTVAL, p_stockin_id, p_part_name, p_manufacturer, p_serial, p_price
    )
    RETURNING STOCKIN_ITEM_ID INTO p_stockin_item_id;
END CREATE_STOCKIN_ITEM;

/

  GRANT EXECUTE ON "APP"."CREATE_STOCKIN_ITEM" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure DELETE_PROFILE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."DELETE_PROFILE" (
    p_profile_name IN VARCHAR2
)
AS
BEGIN
    EXECUTE IMMEDIATE 'DROP PROFILE ' || UPPER(p_profile_name) || ' CASCADE';
END DELETE_PROFILE;

/

  GRANT EXECUTE ON "APP"."DELETE_PROFILE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure DELETE_ROLE_PROC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."DELETE_ROLE_PROC" (p_role_name IN VARCHAR2)
AS
BEGIN
    EXECUTE IMMEDIATE 'DROP ROLE "' || p_role_name || '"';
END;

/

  GRANT EXECUTE ON "APP"."DELETE_ROLE_PROC" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure DENY_PART_REQUEST
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."DENY_PART_REQUEST" (
    p_request_id IN NUMBER
)
AS
BEGIN
    -- 1. Cập nhật trạng thái request
    UPDATE PART_REQUEST
    SET STATUS = 'DENY'
    WHERE REQUEST_ID = p_request_id;



    COMMIT;
END DENY_PART_REQUEST;

/

  GRANT EXECUTE ON "APP"."DENY_PART_REQUEST" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure ENCRYPT_PASSWORD_FOR_EMPLOYEE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."ENCRYPT_PASSWORD_FOR_EMPLOYEE" (
    p_username          IN  VARCHAR2,
    p_password          IN  VARCHAR2,
    p_encrypted_password OUT VARCHAR2
)
AS
    v_pub_key   CLOB;
    v_full_enc  CLOB;
BEGIN
    -- 1. Lấy public key của user từ bảng EMPLOYEE
    SELECT PUBLIC_KEY
    INTO v_pub_key
    FROM EMPLOYEE
    WHERE USERNAME = p_username;

    -- 2. Mã hóa password bằng public key
    v_full_enc := CRYPTO.RSA_ENCRYPT(p_password, v_pub_key);

    -- 3. Trả về 20 ký tự đầu
    p_encrypted_password := SUBSTR(v_full_enc, 1, 20);

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20002, 'Không tìm thấy user ' || p_username);
    WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR(-20003, 'Lỗi khi mã hóa password: ' || SQLERRM);
END ENCRYPT_PASSWORD_FOR_EMPLOYEE;

/

  GRANT EXECUTE ON "APP"."ENCRYPT_PASSWORD_FOR_EMPLOYEE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_APPOINTMENTS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_APPOINTMENTS" (
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT APPOINTMENT_ID,
               CUSTOMER_PHONE,
               APPOINTMENT_DATE,
               STATUS,
               DESCRIPTION
        FROM CUSTOMER_APPOINTMENT
        ORDER BY APPOINTMENT_DATE DESC;
END;

/

  GRANT EXECUTE ON "APP"."GET_ALL_APPOINTMENTS" TO "5";
  GRANT EXECUTE ON "APP"."GET_ALL_APPOINTMENTS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_CUSTOMERS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_CUSTOMERS" (
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT c.PHONE,
               c.FULL_NAME,
               c.EMAIL,
               -- Lấy trạng thái từ DBA_USERS
               (SELECT ACCOUNT_STATUS 
                FROM DBA_USERS d 
                WHERE d.USERNAME = UPPER(c.PHONE)) AS STATUS,
               -- Lấy role gộp thành 1 chuỗi
               (SELECT LISTAGG(GRANTED_ROLE, ', ') WITHIN GROUP (ORDER BY GRANTED_ROLE)
                FROM DBA_ROLE_PRIVS r
                WHERE r.GRANTEE = UPPER(c.PHONE)) AS ROLES
        FROM APP.CUSTOMER c;
END;

/

  GRANT EXECUTE ON "APP"."GET_ALL_CUSTOMERS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_EMPLOYEES
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_EMPLOYEES" (
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT e.EMP_ID,
               e.FULL_NAME,
               e.USERNAME,
               e.EMAIL,
               e.PHONE,
               -- Lấy trạng thái từ DBA_USERS
               (SELECT ACCOUNT_STATUS 
                FROM DBA_USERS d 
                WHERE d.USERNAME = UPPER(e.USERNAME)) AS STATUS,
               -- Lấy role gộp thành 1 chuỗi
               (SELECT LISTAGG(GRANTED_ROLE, ', ') WITHIN GROUP (ORDER BY GRANTED_ROLE)
                FROM DBA_ROLE_PRIVS r
                WHERE r.GRANTEE = UPPER(e.USERNAME)) AS ROLES
        FROM APP.EMPLOYEE e;
END;

/

  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "ADMIN1";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "TIEPTAN1";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "ADMIN2";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "ADMIN3";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "ADMIN4";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "ABC1";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "A";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "B";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "Q";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "WE";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "AQ";
  GRANT EXECUTE ON "APP"."GET_ALL_EMPLOYEES" TO "C";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_IMPORTS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_IMPORTS" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT si.STOCKIN_ID,
           e.USERNAME AS EmpUsername,
           si.IN_DATE,
           si.NOTE
    FROM APP.STOCK_IN si
    JOIN APP.EMPLOYEE e ON si.EMP_ID = e.EMP_ID
    ORDER BY si.STOCKIN_ID;
END GET_ALL_IMPORTS;

/

  GRANT EXECUTE ON "APP"."GET_ALL_IMPORTS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_ORDERS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_ORDERS" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        o.ORDER_ID,
        o.CUSTOMER_PHONE,
        recv.USERNAME AS ReceiverEmpName,
        hand.USERNAME AS HandlerEmpName,
        o.ORDER_TYPE,
        o.RECEIVED_DATE,
        o.STATUS,
        o.DESCRIPTION
    FROM ORDERS o
    LEFT JOIN EMPLOYEE recv ON o.RECEIVER_EMP = recv.EMP_ID
    LEFT JOIN EMPLOYEE hand ON o.HANDLER_EMP = hand.EMP_ID
    ORDER BY o.RECEIVED_DATE DESC;
END GET_ALL_ORDERS;

/

  GRANT EXECUTE ON "APP"."GET_ALL_ORDERS" TO "ADMIN2";
  GRANT EXECUTE ON "APP"."GET_ALL_ORDERS" TO "5";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_PART
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_PART" (
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART;
END get_all_part;

/

  GRANT EXECUTE ON "APP"."GET_ALL_PART" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_PART_IN_STOCK
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_PART_IN_STOCK" (
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            STATUS = 'IN_STOCK';
END GET_ALL_PART_IN_STOCK;

/

  GRANT EXECUTE ON "APP"."GET_ALL_PART_IN_STOCK" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_PART_REQUESTS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_PART_REQUESTS" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        pr.REQUEST_ID,
        pr.ORDER_ID,
        pr.EMP_ID,
        e.USERNAME AS EmpUsername,
        pr.REQUEST_DATE,
        pr.STATUS
    FROM PART_REQUEST pr
    LEFT JOIN EMPLOYEE e ON pr.EMP_ID = e.EMP_ID
    ORDER BY pr.REQUEST_DATE DESC;
END GET_ALL_PART_REQUESTS;

/

  GRANT EXECUTE ON "APP"."GET_ALL_PART_REQUESTS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_PROFILES_WITH_LIMITS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_PROFILES_WITH_LIMITS" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
        SELECT PROFILE,
               RESOURCE_NAME,
               LIMIT
        FROM DBA_PROFILES
        WHERE RESOURCE_NAME IN ('FAILED_LOGIN_ATTEMPTS','PASSWORD_LIFE_TIME','PASSWORD_GRACE_TIME','PASSWORD_LOCK_TIME')
        ORDER BY PROFILE, RESOURCE_NAME;
END GET_ALL_PROFILES_WITH_LIMITS;

/

  GRANT EXECUTE ON "APP"."GET_ALL_PROFILES_WITH_LIMITS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_ROLES
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_ROLES" (p_cursor OUT SYS_REFCURSOR)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT ROLE FROM DBA_ROLES;
END;

/

  GRANT EXECUTE ON "APP"."GET_ALL_ROLES" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_USERS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_USERS" (p_cursor OUT SYS_REFCURSOR)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT USERNAME FROM DBA_USERS;
END;

/

  GRANT EXECUTE ON "APP"."GET_ALL_USERS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ALL_USERS_WITH_PROFILE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ALL_USERS_WITH_PROFILE" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
        SELECT USERNAME, PROFILE
        FROM DBA_USERS
        ORDER BY PROFILE, USERNAME;
END GET_ALL_USERS_WITH_PROFILE;

/

  GRANT EXECUTE ON "APP"."GET_ALL_USERS_WITH_PROFILE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_BY_ORDER_TYPE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_BY_ORDER_TYPE" (
    p_order_type IN VARCHAR2,
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        o.ORDER_ID,
        o.CUSTOMER_PHONE,
        recv.USERNAME AS ReceiverEmpName,
        hand.USERNAME AS HandlerEmpName,
        o.ORDER_TYPE,
        o.RECEIVED_DATE,
        o.STATUS,
        o.DESCRIPTION
    FROM ORDERS o
    LEFT JOIN EMPLOYEE recv ON o.RECEIVER_EMP = recv.EMP_ID
    LEFT JOIN EMPLOYEE hand ON o.HANDLER_EMP = hand.EMP_ID
    WHERE o.ORDER_TYPE = p_order_type
    ORDER BY o.RECEIVED_DATE DESC;
END GET_BY_ORDER_TYPE;

/

  GRANT EXECUTE ON "APP"."GET_BY_ORDER_TYPE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_EMPLOYEE_BY_ID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_EMPLOYEE_BY_ID" (
    p_empid  IN  NUMBER,
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT e.EMP_ID,
               e.FULL_NAME,
               e.USERNAME,
               e.EMAIL,
               e.PHONE,
               -- Lấy trạng thái từ DBA_USERS
               (SELECT d.ACCOUNT_STATUS
                FROM DBA_USERS d
                WHERE d.USERNAME = UPPER(e.USERNAME)) AS STATUS
        FROM APP.EMPLOYEE e
        WHERE e.EMP_ID = p_empid;
END;

/

  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "ADMIN1";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "TIEPTAN1";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "ADMIN2";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "ADMIN3";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "ADMIN4";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "ABC1";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "A";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "B";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "Q";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "WE";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "AQ";
  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_BY_ID" TO "C";
--------------------------------------------------------
--  DDL for Procedure GET_EMPLOYEE_ID_BY_USERNAME
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_EMPLOYEE_ID_BY_USERNAME" (
    p_username IN  VARCHAR2,
    p_emp_id  OUT NUMBER
)
AS
BEGIN
    SELECT EMP_ID
      INTO p_emp_id
      FROM APP.EMPLOYEE
     WHERE USERNAME = p_username;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20001, 'Username không tồn tại: ' || p_username);
    WHEN TOO_MANY_ROWS THEN
        RAISE_APPLICATION_ERROR(-20002, 'Có nhiều hơn một user trùng username: ' || p_username);
END GET_EMPLOYEE_ID_BY_USERNAME;

/

  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_ID_BY_USERNAME" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_EMPLOYEE_NAME_BY_ID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_EMPLOYEE_NAME_BY_ID" (
    p_empid IN NUMBER,
    p_emp_name OUT VARCHAR2
)
AS
BEGIN
    SELECT USERNAME
      INTO p_emp_name
      FROM APP.EMPLOYEE
     WHERE EMP_ID = p_empid;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_emp_name := 'Unknown';
    WHEN TOO_MANY_ROWS THEN
        p_emp_name := 'Multiple Employees';
END GET_EMPLOYEE_NAME_BY_ID;

/

  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_NAME_BY_ID" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_EMPLOYEE_PUBLIC_KEY
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_EMPLOYEE_PUBLIC_KEY" (
    p_emp_id    IN  NUMBER,
    p_pub_key   OUT CLOB
) AS
BEGIN
    SELECT PUBLIC_KEY
    INTO p_pub_key
    FROM APP.EMPLOYEE
    WHERE EMP_ID = p_emp_id;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_pub_key := NULL;
END GET_EMPLOYEE_PUBLIC_KEY;

/

  GRANT EXECUTE ON "APP"."GET_EMPLOYEE_PUBLIC_KEY" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_EMP_ID_FROM_STOCKIN
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_EMP_ID_FROM_STOCKIN" (
    p_stockin_id  IN  NUMBER,
    p_emp_id      OUT NUMBER
) AS
BEGIN
    SELECT EMP_ID
    INTO p_emp_id
    FROM APP.STOCK_IN
    WHERE STOCKIN_ID = p_stockin_id;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_emp_id := NULL;
END GET_EMP_ID_FROM_STOCKIN;

/

  GRANT EXECUTE ON "APP"."GET_EMP_ID_FROM_STOCKIN" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_IMPORT_BY_ID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_IMPORT_BY_ID" (
    p_stockin_id IN NUMBER,
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        si.STOCKIN_ID       AS "StockInId",
        e.FULL_NAME         AS "EmpUsername",
        si.IN_DATE          AS "InDate",
        si.NOTE             AS "Note",
        sii.PART_NAME       AS "PartName",
        sii.MANUFACTURER    AS "Manufacturer",
        sii.SERIAL          AS "Serial",
        NVL(sii.PRICE, 0)  AS "Price"
    FROM APP.STOCK_IN si
    LEFT JOIN APP.STOCK_IN_ITEM sii 
        ON si.STOCKIN_ID = sii.STOCKIN_ID
    LEFT JOIN APP.EMPLOYEE e
        ON si.EMP_ID = e.EMP_ID
    WHERE si.STOCKIN_ID = p_stockin_id;
END GET_IMPORT_BY_ID;

/

  GRANT EXECUTE ON "APP"."GET_IMPORT_BY_ID" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ORDER_BY_ID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ORDER_BY_ID" (
    p_order_id IN ORDERS.ORDER_ID%TYPE,
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        o.ORDER_ID,
        o.CUSTOMER_PHONE,
        recv.USERNAME AS ReceiverEmpName,
        hand.USERNAME AS HandlerEmpName,
        o.ORDER_TYPE,
        o.RECEIVED_DATE,
        o.STATUS,
        o.DESCRIPTION
    FROM ORDERS o
    LEFT JOIN EMPLOYEE recv ON o.RECEIVER_EMP = recv.EMP_ID
    LEFT JOIN EMPLOYEE hand ON o.HANDLER_EMP = hand.EMP_ID
    WHERE o.ORDER_ID = p_order_id;
END GET_ORDER_BY_ID;

/

  GRANT EXECUTE ON "APP"."GET_ORDER_BY_ID" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_PART_BY_ORDERID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PART_BY_ORDERID" (
    p_order_id IN PART.ORDER_ID%TYPE,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            ORDER_ID = p_order_id;
END get_part_by_orderId;

/

  GRANT EXECUTE ON "APP"."GET_PART_BY_ORDERID" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_PART_BY_SERIAL
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PART_BY_SERIAL" (
    p_serial IN PART.SERIAL%TYPE,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            SERIAL = p_serial;
END get_part_by_serial;

/

  GRANT EXECUTE ON "APP"."GET_PART_BY_SERIAL" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_PART_BY_STATUS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PART_BY_STATUS" (
    p_status IN PART.STATUS%TYPE,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            STATUS = p_status;
END get_part_by_status;

/

  GRANT EXECUTE ON "APP"."GET_PART_BY_STATUS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_PART_BY_STOCK
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PART_BY_STOCK" (
    p_stock_id IN PART.STOCK_IN_ID%TYPE,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            STOCK_IN_ID = p_stock_id;
END get_part_by_stock;

/

  GRANT EXECUTE ON "APP"."GET_PART_BY_STOCK" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_PART_BY_STOCKINID
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PART_BY_STOCKINID" (
    p_stockin_id IN PART.STOCK_IN_ID%TYPE,
    p_cursor OUT SYS_REFCURSOR
)
IS
BEGIN
    OPEN p_cursor FOR
        SELECT
            PART_ID,
            NAME,
            MANUFACTURER,
            SERIAL,
            STATUS,
            STOCK_IN_ID,
            ORDER_ID,
            PRICE
        FROM
            PART
        WHERE
            STOCK_IN_ID = p_stockin_id;
END get_part_by_stockinid;

/
--------------------------------------------------------
--  DDL for Procedure GET_PROFILE_BY_NAME
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_PROFILE_BY_NAME" (
    p_profile_name IN VARCHAR2,
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
        SELECT PROFILE,
               RESOURCE_NAME,
               LIMIT
        FROM DBA_PROFILES
        WHERE PROFILE = UPPER(p_profile_name)
          AND RESOURCE_NAME IN ('FAILED_LOGIN_ATTEMPTS','PASSWORD_LIFE_TIME','PASSWORD_GRACE_TIME','PASSWORD_LOCK_TIME')
        ORDER BY RESOURCE_NAME;
END GET_PROFILE_BY_NAME;

/

  GRANT EXECUTE ON "APP"."GET_PROFILE_BY_NAME" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_ROLES_OF_USER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_ROLES_OF_USER" (
    p_username IN VARCHAR2,
    p_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN p_cursor FOR
        SELECT GRANTED_ROLE
        FROM DBA_ROLE_PRIVS
        WHERE GRANTEE = UPPER(p_username);
END;

/

  GRANT EXECUTE ON "APP"."GET_ROLES_OF_USER" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_STOCKIN_SIGNATURE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_STOCKIN_SIGNATURE" (
    p_stockin_id   IN  NUMBER,
    p_signature    OUT CLOB
) AS
BEGIN
    SELECT SIGNATURE
    INTO p_signature
    FROM APP.STOCK_IN
    WHERE STOCKIN_ID = p_stockin_id;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_signature := NULL;
END GET_STOCKIN_SIGNATURE;

/

  GRANT EXECUTE ON "APP"."GET_STOCKIN_SIGNATURE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure GET_UNFINISHED_ORDERS
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."GET_UNFINISHED_ORDERS" (
    cur_out OUT SYS_REFCURSOR
)
AS
BEGIN
    OPEN cur_out FOR
    SELECT 
        o.ORDER_ID,
        o.CUSTOMER_PHONE,
        recv.USERNAME AS ReceiverEmpName,
        hand.USERNAME AS HandlerEmpName,
        o.ORDER_TYPE,
        o.RECEIVED_DATE,
        o.STATUS,
        o.DESCRIPTION
    FROM ORDERS o
    LEFT JOIN EMPLOYEE recv ON o.RECEIVER_EMP = recv.EMP_ID
    LEFT JOIN EMPLOYEE hand ON o.HANDLER_EMP = hand.EMP_ID
    WHERE o.STATUS != 'Hoàn thành'
       OR o.STATUS IS NULL       -- phòng trường hợp giá trị rỗng
    ORDER BY o.RECEIVED_DATE DESC;
END GET_UNFINISHED_ORDERS;

/

  GRANT EXECUTE ON "APP"."GET_UNFINISHED_ORDERS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure LOCK_DB_USER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."LOCK_DB_USER" (
    p_username IN VARCHAR2
)
AS
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'ALTER USER "' || UPPER(p_username) || '" ACCOUNT LOCK';

    EXCEPTION
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20002, 'Không thể lock user ' || p_username || ': ' || SQLERRM);
    END;
END;

/

  GRANT EXECUTE ON "APP"."LOCK_DB_USER" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure LOGIN_CUSTOMER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."LOGIN_CUSTOMER" (
    p_phone        IN  VARCHAR2,
    p_password     IN  VARCHAR2,
    p_out_phone    OUT VARCHAR2,
    p_out_result   OUT VARCHAR2
) AS
    PRAGMA AUTONOMOUS_TRANSACTION;

    v_hash       VARCHAR2(256);
    v_db_hash    VARCHAR2(256);
    v_status     VARCHAR2(10);
    v_fail_count NUMBER;
BEGIN
    v_hash := HASH_PASSWORD(p_password);

    BEGIN
        SELECT PASSWORD_HASH, STATUS
        INTO v_db_hash, v_status
        FROM CUSTOMER
        WHERE PHONE = p_phone;
        p_out_phone := p_phone;

        IF v_status = 'LOCKED' THEN
            p_out_result := 'ACCOUNT LOCKED';
            RETURN;
        END IF;

        IF v_db_hash = v_hash THEN
            p_out_result := 'SUCCESS';
        ELSE
            p_out_result := 'FAILED';
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN

            p_out_phone := NULL;
            
            p_out_result := 'FAILED';
    END;
END LOGIN_CUSTOMER;

/

  GRANT EXECUTE ON "APP"."LOGIN_CUSTOMER" TO "0332880207";
  GRANT EXECUTE ON "APP"."LOGIN_CUSTOMER" TO "5";
  GRANT EXECUTE ON "APP"."LOGIN_CUSTOMER" TO "0332880222";
  GRANT EXECUTE ON "APP"."LOGIN_CUSTOMER" TO "123456";
--------------------------------------------------------
--  DDL for Procedure LOGIN_EMPLOYEE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."LOGIN_EMPLOYEE" (
    p_username     IN  VARCHAR2,
    p_password     IN  VARCHAR2,
    p_out_username OUT VARCHAR2,
    p_out_result   OUT VARCHAR2,
    p_out_role     OUT VARCHAR2
) AS
    PRAGMA AUTONOMOUS_TRANSACTION;

    v_hash       VARCHAR2(256);
    v_db_hash    VARCHAR2(256);
    v_status     VARCHAR2(30);
BEGIN
    v_hash := HASH_PASSWORD(p_password);

    BEGIN
        -- Lấy mật khẩu từ bảng EMPLOYEE
        SELECT PASSWORD_HASH
        INTO v_db_hash
        FROM EMPLOYEE
        WHERE USERNAME = p_username;

        p_out_username := p_username;

        -- Lấy trạng thái từ DBA_USERS
        BEGIN
            SELECT ACCOUNT_STATUS
            INTO v_status
            FROM DBA_USERS
            WHERE USERNAME = UPPER(p_username);
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                v_status := 'UNKNOWN';
        END;

        IF v_status LIKE 'LOCKED%' THEN
            p_out_result := 'ACCOUNT LOCKED';
            p_out_role := NULL;
            RETURN;
        END IF;

        IF v_db_hash = v_hash THEN
            p_out_result := 'SUCCESS';

            -- Lấy role của user
            BEGIN
                SELECT LISTAGG(GRANTED_ROLE, ', ') WITHIN GROUP (ORDER BY GRANTED_ROLE)
                INTO p_out_role
                FROM DBA_ROLE_PRIVS
                WHERE GRANTEE = UPPER(p_username);
            EXCEPTION
                WHEN NO_DATA_FOUND THEN
                    p_out_role := NULL;
            END;

        ELSE
            p_out_result := 'FAILED';
            p_out_role := NULL;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            p_out_username := NULL;
            p_out_result := 'FAILED';
            p_out_role := NULL;
    END;
END LOGIN_EMPLOYEE;

/

  GRANT EXECUTE ON "APP"."LOGIN_EMPLOYEE" TO "C";
  GRANT EXECUTE ON "APP"."LOGIN_EMPLOYEE" TO "5";
  GRANT EXECUTE ON "APP"."LOGIN_EMPLOYEE" TO "ADMIN30";
  GRANT EXECUTE ON "APP"."LOGIN_EMPLOYEE" TO "ADMIN31";
  GRANT EXECUTE ON "APP"."LOGIN_EMPLOYEE" TO "ADMIN21";
--------------------------------------------------------
--  DDL for Procedure REGISTER_CUSTOMER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."REGISTER_CUSTOMER" (
    p_phone     IN VARCHAR2,   -- dùng làm PK
    p_full_name IN VARCHAR2,
    p_password  IN VARCHAR2,
    p_email     IN VARCHAR2,
    p_address   IN VARCHAR2
)
AS
    v_hash VARCHAR2(256);
    v_pub  CLOB;
    v_priv CLOB;
    v_keys      CLOB;
    v_pwd VARCHAR2(20);
BEGIN
    -- Hash mật khẩu
    v_hash := HASH_PASSWORD(p_password);

    -- 2. Sinh cặp RSA
    v_keys := CRYPTO.RSA_GENERATE_KEYS(KEY_SIZE => 1024);

    -- 3. Tách public key (loại bỏ ****)
    v_pub := TRIM(
                SUBSTR(
                    v_keys,
                    INSTR(v_keys, 'publicKey start*****') + LENGTH('publicKey start*****'),
                    INSTR(v_keys, '****publicKey end') - (INSTR(v_keys, 'publicKey start*****') + LENGTH('publicKey start*****'))
                )
             );

    -- 4. Tách private key (loại bỏ ****)
    v_priv := TRIM(
                 SUBSTR(
                     v_keys,
                     INSTR(v_keys, 'privateKey start****') + LENGTH('privateKey start****'),
                     INSTR(v_keys, '****privateKey end') - (INSTR(v_keys, 'privateKey start****') + LENGTH('privateKey start****'))
                 )
              );
    v_pwd := HASH_PASSWORD_20CHARS(p_password);
    -- 1. Tạo Oracle DB user trước
    BEGIN
        EXECUTE IMMEDIATE 'CREATE USER "' || p_phone || '"' ||
                          ' IDENTIFIED BY "' || v_pwd || '"' ||
                          ' DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS';

        EXECUTE IMMEDIATE 'GRANT CONNECT, RESOURCE TO "' || p_phone || '"';
        EXECUTE IMMEDIATE 'GRANT EXECUTE ON APP.LOGIN_CUSTOMER TO "' || p_phone || '"';
    EXCEPTION
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20002, 'Không thể tạo DB User cho Customer ' || p_phone || ': ' || SQLERRM);
    END;

    -- 2. Insert vào bảng CUSTOMER (chỉ khi tạo DB user thành công)
    BEGIN
        INSERT INTO CUSTOMER(PHONE, FULL_NAME, PASSWORD_HASH, PUBLIC_KEY, EMAIL, ADDRESS, STATUS)
        VALUES (p_phone, p_full_name, v_hash, v_pub, p_email, p_address, 'ACTIVE');

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            -- Nếu lỗi ở bước insert thì rollback + xóa DB user vừa tạo
            ROLLBACK;
            BEGIN
                EXECUTE IMMEDIATE 'DROP USER "' || p_phone || '" CASCADE';
            EXCEPTION
                WHEN OTHERS THEN NULL;
            END;
            RAISE;
    END;

END REGISTER_CUSTOMER;

/
--------------------------------------------------------
--  DDL for Procedure REGISTER_EMPLOYEE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."REGISTER_EMPLOYEE" (
    p_empid       IN NUMBER DEFAULT NULL,   
    p_full_name   IN VARCHAR2,
    p_username    IN VARCHAR2,
    p_password    IN VARCHAR2,
    p_email       IN VARCHAR2,
    p_phone       IN VARCHAR2,
    p_private_key OUT CLOB
)
AS
    v_hash      VARCHAR2(256);
    v_pub       CLOB;
    v_priv      CLOB;
    v_keys      CLOB;
    v_pwd VARCHAR2(20);
BEGIN
    -- 1. Hash mật khẩu
    v_hash := HASH_PASSWORD(p_password);

    -- 2. Sinh cặp RSA
    v_keys := CRYPTO.RSA_GENERATE_KEYS(KEY_SIZE => 1024);

    -- 3. Tách public key (loại bỏ ****)
    v_pub := TRIM(
                SUBSTR(
                    v_keys,
                    INSTR(v_keys, 'publicKey start*****') + LENGTH('publicKey start*****'),
                    INSTR(v_keys, '****publicKey end') - (INSTR(v_keys, 'publicKey start*****') + LENGTH('publicKey start*****'))
                )
             );

    -- 4. Tách private key (loại bỏ ****)
    v_priv := TRIM(
                 SUBSTR(
                     v_keys,
                     INSTR(v_keys, 'privateKey start****') + LENGTH('privateKey start****'),
                     INSTR(v_keys, '****privateKey end') - (INSTR(v_keys, 'privateKey start****') + LENGTH('privateKey start****'))
                 )
              );
    v_pwd := HASH_PASSWORD_20CHARS(p_password);
    -- 5. Tạo Oracle DB user
    BEGIN
        EXECUTE IMMEDIATE 'CREATE USER ' || p_username ||
                  ' IDENTIFIED BY "' || v_pwd || '" DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS';
        EXECUTE IMMEDIATE 'GRANT CONNECT, RESOURCE TO ' || p_username;
        EXECUTE IMMEDIATE 'GRANT EXECUTE ON LOGIN_EMPLOYEE TO ' || p_username;
    EXCEPTION
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20001, 'Không thể tạo DB User cho nhân viên: ' || SQLERRM);
    END;

    -- 6. Insert vào EMPLOYEE
    IF p_empid IS NULL THEN
        INSERT INTO EMPLOYEE(FULL_NAME, USERNAME, PASSWORD_HASH, PUBLIC_KEY, EMAIL, PHONE)
        VALUES (p_full_name, p_username, v_hash, v_pub, p_email, p_phone);
    ELSE
        INSERT INTO EMPLOYEE(EMP_ID, FULL_NAME, USERNAME, PASSWORD_HASH, PUBLIC_KEY, EMAIL, PHONE)
        VALUES (p_empid, p_full_name, p_username, v_hash, v_pub, p_email, p_phone);
    END IF;

    -- 7. Trả private key ra OUT param
    p_private_key := v_priv;

    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        BEGIN
            EXECUTE IMMEDIATE 'DROP USER ' || p_username || ' CASCADE';
        EXCEPTION
            WHEN OTHERS THEN NULL;
        END;
        RAISE;
END;

/

  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "ADMIN1";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "TIEPTAN1";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "ADMIN2";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "ADMIN3";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "ADMIN4";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "ABC1";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "A";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "B";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "Q";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "WE";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "AQ";
  GRANT EXECUTE ON "APP"."REGISTER_EMPLOYEE" TO "C";
--------------------------------------------------------
--  DDL for Procedure REVOKE_ROLE_PROC
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."REVOKE_ROLE_PROC" (
    p_username IN VARCHAR2,
    p_role_name IN VARCHAR2
)
AS
BEGIN
    EXECUTE IMMEDIATE 'REVOKE "' || p_role_name || '" FROM "' || p_username || '"';
END;

/

  GRANT EXECUTE ON "APP"."REVOKE_ROLE_PROC" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure SIGN_STOCKIN
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."SIGN_STOCKIN" (
    p_stockin_id    IN NUMBER,
    p_private_key   IN VARCHAR2,
    p_signature     OUT CLOB
) AS
    l_items_to_sign  CLOB;
    l_data_to_sign   CLOB;
    l_hash_raw       RAW(32);
    l_hash_hex       VARCHAR2(64);
BEGIN
    -- 1. Nối tất cả item với format cố định
    SELECT LISTAGG(
               TRIM(si.STOCKIN_ITEM_ID) || '|' ||
               TRIM(si.PART_NAME) || '|' ||
               TRIM(NVL(si.MANUFACTURER,'')) || '|' ||
               TRIM(si.SERIAL) || '|' ||
               TO_CHAR(si.PRICE,'FM9999990.00')
           , ';') WITHIN GROUP (ORDER BY si.STOCKIN_ITEM_ID)
    INTO l_items_to_sign
    FROM APP.STOCK_IN_ITEM si
    WHERE si.STOCKIN_ID = p_stockin_id;

    -- 2. Lấy header với format ngày và trim
    SELECT TRIM(s.STOCKIN_ID) || '|' || TRIM(s.EMP_ID) || '|' || TO_CHAR(s.IN_DATE,'YYYYMMDD') || '|' || TRIM(NVL(s.NOTE,''))
    INTO l_data_to_sign
    FROM APP.STOCK_IN s
    WHERE s.STOCKIN_ID = p_stockin_id;

    -- 3. Nối header + items
    l_data_to_sign := l_data_to_sign || '|' || l_items_to_sign;
    
    -- 4. Hash SHA-256
    l_hash_raw := DBMS_CRYPTO.HASH(UTL_RAW.CAST_TO_RAW(l_data_to_sign), DBMS_CRYPTO.HASH_SH256);
    l_hash_hex := RAWTOHEX(l_hash_raw);
    
    -- 5. Ký hash
    p_signature := CRYPTO.RSA_SIGN(l_hash_hex, p_private_key);
        

END SIGN_STOCKIN;

/

  GRANT EXECUTE ON "APP"."SIGN_STOCKIN" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure UNLOCK_DB_USER
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."UNLOCK_DB_USER" (
    p_username IN VARCHAR2
)
AS
BEGIN
    BEGIN
        EXECUTE IMMEDIATE 'ALTER USER "' || UPPER(p_username) || '" ACCOUNT UNLOCK';

    EXCEPTION
        WHEN OTHERS THEN
            RAISE_APPLICATION_ERROR(-20001, 'Không thể unlock user ' || p_username || ': ' || SQLERRM);
    END;
END;

/

  GRANT EXECUTE ON "APP"."UNLOCK_DB_USER" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure UPDATE_ORDER_STATUS_WAIT_PART
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."UPDATE_ORDER_STATUS_WAIT_PART" (
    p_order_id IN NUMBER
)
AS
BEGIN
    -- Cập nhật trạng thái trong bảng PART_REQUEST (hoặc bảng ORDER)
    UPDATE ORDERS
       SET STATUS = 'Đang chờ linh kiện'
     WHERE ORDER_ID = p_order_id;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END UPDATE_ORDER_STATUS_WAIT_PART;

/

  GRANT EXECUTE ON "APP"."UPDATE_ORDER_STATUS_WAIT_PART" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure UPDATE_STOCKIN_SIGNATURE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."UPDATE_STOCKIN_SIGNATURE" (
    p_stockin_id IN NUMBER,
    p_signature  IN VARCHAR2
) AS
BEGIN
    UPDATE APP.STOCK_IN
    SET SIGNATURE = p_signature
    WHERE STOCKIN_ID = p_stockin_id;
END UPDATE_STOCKIN_SIGNATURE;

/

  GRANT EXECUTE ON "APP"."UPDATE_STOCKIN_SIGNATURE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Procedure VERIFY_STOCKIN_SIGNATURE
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "APP"."VERIFY_STOCKIN_SIGNATURE" (
    p_stockin_id   IN NUMBER,
    p_public_key   IN VARCHAR2,
    p_signature    IN CLOB,
    p_is_valid     OUT NUMBER
) AS
    l_items_to_sign  CLOB;
    l_data_to_sign   CLOB;
    l_hash_raw       RAW(32);
    l_hash_hex       VARCHAR2(64);
    l_verified       BOOLEAN;
BEGIN
    -- 1. Nối tất cả item với cùng format như SIGN
    SELECT LISTAGG(
               TRIM(si.STOCKIN_ITEM_ID) || '|' ||
               TRIM(si.PART_NAME) || '|' ||
               TRIM(NVL(si.MANUFACTURER,'')) || '|' ||
               TRIM(si.SERIAL) || '|' ||
               TO_CHAR(si.PRICE,'FM9999990.00')
           , ';') WITHIN GROUP (ORDER BY si.STOCKIN_ITEM_ID)
    INTO l_items_to_sign
    FROM APP.STOCK_IN_ITEM si
    WHERE si.STOCKIN_ID = p_stockin_id;

    -- 2. Lấy header với format ngày và trim
    SELECT TRIM(s.STOCKIN_ID) || '|' || TRIM(s.EMP_ID) || '|' || TO_CHAR(s.IN_DATE,'YYYYMMDD') || '|' || TRIM(NVL(s.NOTE,''))
    INTO l_data_to_sign
    FROM APP.STOCK_IN s
    WHERE s.STOCKIN_ID = p_stockin_id;

    -- 3. Nối header + items
    l_data_to_sign := l_data_to_sign || '|' || l_items_to_sign;

    -- 4. Hash SHA-256
    l_hash_raw := DBMS_CRYPTO.HASH(UTL_RAW.CAST_TO_RAW(l_data_to_sign), DBMS_CRYPTO.HASH_SH256);
    l_hash_hex := RAWTOHEX(l_hash_raw);

    -- 5. Verify với Java RSA_VERIFY
    l_verified := CRYPTO.RSA_VERIFY(l_hash_hex, p_signature, p_public_key);

    IF l_verified THEN
        p_is_valid := 1;  -- valid
    ELSE
        p_is_valid := 0;  -- invalid
    END IF;
END VERIFY_STOCKIN_SIGNATURE;

/

  GRANT EXECUTE ON "APP"."VERIFY_STOCKIN_SIGNATURE" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Package APP_CTX_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "APP"."APP_CTX_PKG" AS
  PROCEDURE set_role(p_role_name IN VARCHAR2);
  PROCEDURE set_emp(p_emp_id IN NUMBER);
  PROCEDURE set_customer(p_customer_phone IN VARCHAR2);
END APP_CTX_PKG;

/

  GRANT EXECUTE ON "APP"."APP_CTX_PKG" TO PUBLIC;
--------------------------------------------------------
--  DDL for Package CRYPTO
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "APP"."CRYPTO" AS 
FUNCTION RSA_ENCRYPT(PLAIN_TEXT VARCHAR2,PRIVATE_KEY VARCHAR2) RETURN VARCHAR2
AS
LANGUAGE JAVA NAME 'com/dishtavar/crypto4ora/RSAUtil.encrypt (java.lang.String,java.lang.String) return java.lang.String';


FUNCTION RSA_DECRYPT(ENCRYPTED_TEXT VARCHAR2,PUBLIC_KEY VARCHAR2) RETURN VARCHAR2
AS
LANGUAGE JAVA NAME 'com/dishtavar/crypto4ora/RSAUtil.decrypt (java.lang.String,java.lang.String) return java.lang.String';


FUNCTION RSA_SIGN(HASH_MESSAGE VARCHAR2,PUBLIC_KEY VARCHAR2) RETURN VARCHAR2
AS
LANGUAGE JAVA NAME 'com/dishtavar/crypto4ora/RSAUtil.sign (java.lang.String,java.lang.String) return java.lang.String';


FUNCTION RSA_VERIFY(PLAIN_HASH VARCHAR2,SIGNNED_HASH VARCHAR2,PRIVATE_KEY VARCHAR2) RETURN BOOLEAN
AS
LANGUAGE JAVA NAME 'com/dishtavar/crypto4ora/RSAUtil.verify (java.lang.String,java.lang.String,java.lang.String) return java.lang.Boolean';

FUNCTION RSA_GENERATE_KEYS(KEY_SIZE NUMBER) RETURN VARCHAR2
AS
LANGUAGE JAVA NAME 'com/dishtavar/crypto4ora/GenerateKey.generateRSAKeys (java.lang.Integer) return java.lang.String';

END CRYPTO;

/
--------------------------------------------------------
--  DDL for Package Body APP_CTX_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APP"."APP_CTX_PKG" AS
  PROCEDURE set_role(p_role_name IN VARCHAR2) IS
  BEGIN
    DBMS_SESSION.SET_CONTEXT('APP_CTX','ROLE_NAME', UPPER(p_role_name));
  END;

  PROCEDURE set_emp(p_emp_id IN NUMBER) IS
  BEGIN
    DBMS_SESSION.SET_CONTEXT('APP_CTX','EMP_ID', TO_CHAR(p_emp_id));
  END;

  PROCEDURE set_customer(p_customer_phone IN VARCHAR2) IS
  BEGIN
    DBMS_SESSION.SET_CONTEXT('APP_CTX','CUSTOMER_PHONE', p_customer_phone);
  END;
END APP_CTX_PKG;

/

  GRANT EXECUTE ON "APP"."APP_CTX_PKG" TO PUBLIC;
--------------------------------------------------------
--  DDL for Function APPOINTMENT_VPD_PREDICATE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."APPOINTMENT_VPD_PREDICATE" (
  p_schema  IN VARCHAR2,
  p_object  IN VARCHAR2
) RETURN VARCHAR2
AS
  v_role VARCHAR2(100) := SYS_CONTEXT('APP_CTX','ROLE_NAME');
  v_cus  VARCHAR2(100) := SYS_CONTEXT('APP_CTX','CUSTOMER_PHONE');
BEGIN
  IF v_role IS NULL THEN
    RETURN '1=0';
  END IF;

  IF v_role IN ('ROLE_ADMIN','ROLE_TIEPTAN') THEN
    RETURN '1=1';
  END IF;

  IF v_role = 'ROLE_KHACHHANG' THEN
    IF v_cus IS NULL THEN
      RETURN '1=0';
    END IF;
    RETURN 'CUSTOMER_PHONE = ''' || REPLACE(v_cus,'''','''''') || '''';
  END IF;

  -- THUKHO, KITHUATVIEN and others: deny
  RETURN '1=0';
END;

/
--------------------------------------------------------
--  DDL for Function APPOINTMENT_VPD_PREDICATE_DEL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."APPOINTMENT_VPD_PREDICATE_DEL" (
  p_schema  IN VARCHAR2,
  p_object  IN VARCHAR2
) RETURN VARCHAR2
AS
BEGIN
  RETURN '1=0';
END;

/
--------------------------------------------------------
--  DDL for Function HASH_PASSWORD
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."HASH_PASSWORD" (p_password VARCHAR2) RETURN VARCHAR2 IS
    v_raw RAW(32);
BEGIN
    v_raw := DBMS_CRYPTO.HASH(
        UTL_I18N.STRING_TO_RAW(p_password, 'AL32UTF8'),
        DBMS_CRYPTO.HASH_SH256
    );
    RETURN RAWTOHEX(v_raw);
END;

/
--------------------------------------------------------
--  DDL for Function HASH_PASSWORD_20CHARS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."HASH_PASSWORD_20CHARS" (p_password VARCHAR2) 
RETURN VARCHAR2
IS
    v_raw RAW(32);     -- SHA256 trả về 32 byte
    v_hex VARCHAR2(64); -- chuyển sang HEX, 64 ký tự
BEGIN
    -- 1. Tính SHA256
    v_raw := DBMS_CRYPTO.HASH(
                UTL_I18N.STRING_TO_RAW(p_password, 'AL32UTF8'),
                DBMS_CRYPTO.HASH_SH256
             );

    -- 2. RAW -> HEX
    v_hex := RAWTOHEX(v_raw); -- 64 ký tự HEX

    -- 3. Trả về 10 ký tự đầu + 10 ký tự cuối
    RETURN SUBSTR(v_hex, 1, 10) || SUBSTR(v_hex, -10);  
END HASH_PASSWORD_20CHARS;

/

  GRANT EXECUTE ON "APP"."HASH_PASSWORD_20CHARS" TO "ADMIN2";
--------------------------------------------------------
--  DDL for Function ORDERS_VPD_PREDICATE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."ORDERS_VPD_PREDICATE" (
  p_schema  IN VARCHAR2,
  p_object  IN VARCHAR2
) RETURN VARCHAR2
AS
  v_role VARCHAR2(100) := SYS_CONTEXT('APP_CTX','ROLE_NAME');
  v_emp  VARCHAR2(100) := SYS_CONTEXT('APP_CTX','EMP_ID');
  v_cus  VARCHAR2(100) := SYS_CONTEXT('APP_CTX','CUSTOMER_PHONE');
BEGIN
  IF v_role IS NULL THEN
    RETURN '1=0';
  END IF;

  IF v_role IN ('ROLE_ADMIN','ROLE_TIEPTAN') THEN
    RETURN '1=1';
  END IF;

  IF v_role = 'ROLE_KITHUATVIEN' THEN
    IF v_emp IS NULL THEN
      RETURN '1=0';
    END IF;
    RETURN 'HANDLER_EMP = ' || TO_NUMBER(v_emp);
  END IF;

  IF v_role = 'ROLE_KHACHHANG' THEN
    IF v_cus IS NULL THEN
      RETURN '1=0';
    END IF;
    RETURN 'CUSTOMER_PHONE = ''' || REPLACE(v_cus,'''','''''') || '''';
  END IF;

  IF v_role = 'ROLE_THUKHO' THEN
    RETURN '1=0';
  END IF;

  RETURN '1=0';
END;

/
--------------------------------------------------------
--  DDL for Function ORDERS_VPD_PREDICATE_DEL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."ORDERS_VPD_PREDICATE_DEL" (
  p_schema  IN VARCHAR2,
  p_object  IN VARCHAR2
) RETURN VARCHAR2
AS
BEGIN
  RETURN '1=0';
END;

/
--------------------------------------------------------
--  DDL for Function ORDERS_VPD_PREDICATE_UPD
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "APP"."ORDERS_VPD_PREDICATE_UPD" (
  p_schema  IN VARCHAR2,
  p_object  IN VARCHAR2
) RETURN VARCHAR2
AS
  v_role VARCHAR2(100) := SYS_CONTEXT('APP_CTX','ROLE_NAME');
  v_emp  VARCHAR2(100) := SYS_CONTEXT('APP_CTX','EMP_ID');
BEGIN
  IF v_role IS NULL THEN
    RETURN '1=0';
  END IF;

  IF v_role = 'ROLE_ADMIN' THEN
    RETURN '1=1';
  END IF;

  IF v_role = 'ROLE_KITHUATVIEN' THEN
    IF v_emp IS NULL THEN
      RETURN '1=0';
    END IF;
    RETURN 'HANDLER_EMP = ' || TO_NUMBER(v_emp);
  END IF;

  RETURN '1=0';
END;

/
--------------------------------------------------------
--  Constraints for Table INVOICE
--------------------------------------------------------

  ALTER TABLE "APP"."INVOICE" MODIFY ("STOCKOUT_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE" MODIFY ("CUSTOMER_PHONE" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE" ADD PRIMARY KEY ("INVOICE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table EMPLOYEE_SHIFT
--------------------------------------------------------

  ALTER TABLE "APP"."EMPLOYEE_SHIFT" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE_SHIFT" MODIFY ("SHIFT_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE_SHIFT" MODIFY ("START_TIME" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE_SHIFT" MODIFY ("END_TIME" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE_SHIFT" ADD PRIMARY KEY ("SHIFT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table CREATE$JAVA$LOB$TABLE
--------------------------------------------------------

  ALTER TABLE "APP"."CREATE$JAVA$LOB$TABLE" ADD UNIQUE ("NAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table STOCK_IN_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_IN_ITEM" MODIFY ("STOCKIN_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_IN_ITEM" MODIFY ("PART_NAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_IN_ITEM" MODIFY ("SERIAL" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_IN_ITEM" ADD PRIMARY KEY ("STOCKIN_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "APP"."STOCK_IN_ITEM" ADD UNIQUE ("SERIAL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USER_OTP_LOG
--------------------------------------------------------

  ALTER TABLE "APP"."USER_OTP_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."USER_OTP_LOG" MODIFY ("USER_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."USER_OTP_LOG" MODIFY ("USERNAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."USER_OTP_LOG" MODIFY ("OTP" NOT NULL ENABLE);
  ALTER TABLE "APP"."USER_OTP_LOG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table PART
--------------------------------------------------------

  ALTER TABLE "APP"."PART" MODIFY ("STOCK_IN_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART" MODIFY ("SERIAL" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART" MODIFY ("STATUS" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART" ADD PRIMARY KEY ("PART_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "APP"."PART" ADD UNIQUE ("SERIAL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table CUSTOMER
--------------------------------------------------------

  ALTER TABLE "APP"."CUSTOMER" MODIFY ("FULL_NAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."CUSTOMER" ADD PRIMARY KEY ("PHONE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table PART_REQUEST_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."PART_REQUEST_ITEM" MODIFY ("REQUEST_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST_ITEM" MODIFY ("PART_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST_ITEM" ADD PRIMARY KEY ("REQUEST_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table STOCK_IN
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_IN" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_IN" MODIFY ("IN_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_IN" ADD PRIMARY KEY ("STOCKIN_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table INVOICE_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."INVOICE_ITEM" MODIFY ("INVOICE_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE_ITEM" MODIFY ("STOCKOUT_ITEM_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE_ITEM" MODIFY ("PART_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE_ITEM" MODIFY ("PRICE" NOT NULL ENABLE);
  ALTER TABLE "APP"."INVOICE_ITEM" ADD PRIMARY KEY ("INVOICE_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ORDERS
--------------------------------------------------------

  ALTER TABLE "APP"."ORDERS" MODIFY ("CUSTOMER_PHONE" NOT NULL ENABLE);
  ALTER TABLE "APP"."ORDERS" MODIFY ("RECEIVER_EMP" NOT NULL ENABLE);
  ALTER TABLE "APP"."ORDERS" MODIFY ("ORDER_TYPE" NOT NULL ENABLE);
  ALTER TABLE "APP"."ORDERS" MODIFY ("RECEIVED_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."ORDERS" MODIFY ("STATUS" NOT NULL ENABLE);
  ALTER TABLE "APP"."ORDERS" ADD PRIMARY KEY ("ORDER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table STOCK_OUT_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_OUT_ITEM" MODIFY ("STOCKOUT_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_OUT_ITEM" MODIFY ("PART_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_OUT_ITEM" ADD PRIMARY KEY ("STOCKOUT_ITEM_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table CUSTOMER_APPOINTMENT
--------------------------------------------------------

  ALTER TABLE "APP"."CUSTOMER_APPOINTMENT" MODIFY ("CUSTOMER_PHONE" NOT NULL ENABLE);
  ALTER TABLE "APP"."CUSTOMER_APPOINTMENT" MODIFY ("APPOINTMENT_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."CUSTOMER_APPOINTMENT" ADD PRIMARY KEY ("APPOINTMENT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table PART_REQUEST
--------------------------------------------------------

  ALTER TABLE "APP"."PART_REQUEST" MODIFY ("ORDER_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST" MODIFY ("REQUEST_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST" MODIFY ("STATUS" NOT NULL ENABLE);
  ALTER TABLE "APP"."PART_REQUEST" ADD PRIMARY KEY ("REQUEST_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table STOCK_OUT
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_OUT" MODIFY ("ORDER_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_OUT" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_OUT" MODIFY ("OUT_DATE" NOT NULL ENABLE);
  ALTER TABLE "APP"."STOCK_OUT" ADD PRIMARY KEY ("STOCKOUT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table EMPLOYEE
--------------------------------------------------------

  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("EMP_ID" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("FULL_NAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("USERNAME" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("PASSWORD_HASH" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("EMAIL" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" MODIFY ("PHONE" NOT NULL ENABLE);
  ALTER TABLE "APP"."EMPLOYEE" ADD PRIMARY KEY ("EMP_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "APP"."EMPLOYEE" ADD UNIQUE ("USERNAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "APP"."EMPLOYEE" ADD UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "APP"."EMPLOYEE" ADD UNIQUE ("PHONE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table CUSTOMER_APPOINTMENT
--------------------------------------------------------

  ALTER TABLE "APP"."CUSTOMER_APPOINTMENT" ADD CONSTRAINT "FK_APPOINTMENT_CUSTOMER" FOREIGN KEY ("CUSTOMER_PHONE")
	  REFERENCES "APP"."CUSTOMER" ("PHONE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table EMPLOYEE_SHIFT
--------------------------------------------------------

  ALTER TABLE "APP"."EMPLOYEE_SHIFT" ADD CONSTRAINT "FK_SHIFT_EMPLOYEE" FOREIGN KEY ("EMP_ID")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table INVOICE
--------------------------------------------------------

  ALTER TABLE "APP"."INVOICE" ADD CONSTRAINT "FK_INVOICE_STOCKOUT" FOREIGN KEY ("STOCKOUT_ID")
	  REFERENCES "APP"."STOCK_OUT" ("STOCKOUT_ID") ENABLE;
  ALTER TABLE "APP"."INVOICE" ADD CONSTRAINT "FK_INVOICE_CUSTOMER" FOREIGN KEY ("CUSTOMER_PHONE")
	  REFERENCES "APP"."CUSTOMER" ("PHONE") ENABLE;
  ALTER TABLE "APP"."INVOICE" ADD CONSTRAINT "FK_INVOICE_EMPLOYEE" FOREIGN KEY ("EMP_ID")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table INVOICE_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."INVOICE_ITEM" ADD CONSTRAINT "FK_INVOICEITEM_INVOICE" FOREIGN KEY ("INVOICE_ID")
	  REFERENCES "APP"."INVOICE" ("INVOICE_ID") ENABLE;
  ALTER TABLE "APP"."INVOICE_ITEM" ADD CONSTRAINT "FK_INVOICEITEM_STOCKOUTITEM" FOREIGN KEY ("STOCKOUT_ITEM_ID")
	  REFERENCES "APP"."STOCK_OUT_ITEM" ("STOCKOUT_ITEM_ID") ENABLE;
  ALTER TABLE "APP"."INVOICE_ITEM" ADD CONSTRAINT "FK_INVOICEITEM_PART" FOREIGN KEY ("PART_ID")
	  REFERENCES "APP"."PART" ("PART_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ORDERS
--------------------------------------------------------

  ALTER TABLE "APP"."ORDERS" ADD CONSTRAINT "FK_ORDER_HANDLEEMPLOYEE" FOREIGN KEY ("HANDLER_EMP")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
  ALTER TABLE "APP"."ORDERS" ADD CONSTRAINT "FK_ORDER_CUSTOMER" FOREIGN KEY ("CUSTOMER_PHONE")
	  REFERENCES "APP"."CUSTOMER" ("PHONE") ENABLE;
  ALTER TABLE "APP"."ORDERS" ADD CONSTRAINT "FK_ORDER_EMPLOYEE" FOREIGN KEY ("RECEIVER_EMP")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PART
--------------------------------------------------------

  ALTER TABLE "APP"."PART" ADD CONSTRAINT "FK_PART_STOCKIN" FOREIGN KEY ("STOCK_IN_ID")
	  REFERENCES "APP"."STOCK_IN" ("STOCKIN_ID") ENABLE;
  ALTER TABLE "APP"."PART" ADD CONSTRAINT "FK_PART_ORDER" FOREIGN KEY ("ORDER_ID")
	  REFERENCES "APP"."ORDERS" ("ORDER_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PART_REQUEST
--------------------------------------------------------

  ALTER TABLE "APP"."PART_REQUEST" ADD CONSTRAINT "FK_PARTREQUEST_ORDER" FOREIGN KEY ("ORDER_ID")
	  REFERENCES "APP"."ORDERS" ("ORDER_ID") ENABLE;
  ALTER TABLE "APP"."PART_REQUEST" ADD CONSTRAINT "FK_PARTREQUEST_EMPLOYEE" FOREIGN KEY ("EMP_ID")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table PART_REQUEST_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."PART_REQUEST_ITEM" ADD CONSTRAINT "FK_PARTREQUESTITEM_REQUEST" FOREIGN KEY ("REQUEST_ID")
	  REFERENCES "APP"."PART_REQUEST" ("REQUEST_ID") ENABLE;
  ALTER TABLE "APP"."PART_REQUEST_ITEM" ADD CONSTRAINT "FK_PARTREQUESTITEM_PART" FOREIGN KEY ("PART_ID")
	  REFERENCES "APP"."PART" ("PART_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table STOCK_IN
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_IN" ADD CONSTRAINT "FK_STOCKIN_EMPLOYEE" FOREIGN KEY ("EMP_ID")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table STOCK_IN_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_IN_ITEM" ADD CONSTRAINT "FK_STOCKINITEM_STOCKIN" FOREIGN KEY ("STOCKIN_ID")
	  REFERENCES "APP"."STOCK_IN" ("STOCKIN_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table STOCK_OUT
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_OUT" ADD CONSTRAINT "FK_STOCKOUT_ORDER" FOREIGN KEY ("ORDER_ID")
	  REFERENCES "APP"."ORDERS" ("ORDER_ID") ENABLE;
  ALTER TABLE "APP"."STOCK_OUT" ADD CONSTRAINT "FK_STOCKOUT_EMPLOYEE" FOREIGN KEY ("EMP_ID")
	  REFERENCES "APP"."EMPLOYEE" ("EMP_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table STOCK_OUT_ITEM
--------------------------------------------------------

  ALTER TABLE "APP"."STOCK_OUT_ITEM" ADD CONSTRAINT "FK_STOCKOUTITEM_STOCKOUT" FOREIGN KEY ("STOCKOUT_ID")
	  REFERENCES "APP"."STOCK_OUT" ("STOCKOUT_ID") ENABLE;
  ALTER TABLE "APP"."STOCK_OUT_ITEM" ADD CONSTRAINT "FK_STOCKOUTITEM_PART" FOREIGN KEY ("PART_ID")
	  REFERENCES "APP"."PART" ("PART_ID") ENABLE;
